; extensions.conf - the Asterisk dial plan
;
; Static extension configuration file, used by
; the pbx_config module. This is where you configure all your
; inbound and outbound calls in Asterisk.
;
; This configuration file is reloaded
; - With the "dialplan reload" command in the CLI
; - With the "reload" command (that reloads everything) in the CLI

;
; The "General" category is for certain variables.
;
[general]
autofallthrough=yes
[default]
;exten => _66785800,1,Hangup()

[phones]
include => internal
include => remote 



[playcinthol]

exten => 190,1,Answer()
;exten => 190,n,NoOp(Calling cinthol update current call http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_Cinthol.CINTHOL_UPDATE_CURRENTCALL&INTOKEN=2&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=1)
;exten => 190,n,Set(response1=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_Cinthol.CINTHOL_UPDATE_CURRENTCALL&INTOKEN=2&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=1)})
;exten => 190,n,NoOp(response=${response})
exten => 190,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/Cinthol/hin/OBD_HINDI)
exten => 190,n,hangup()

exten => h,1,NoOp(hangup called)
exten => h,n,NoOp(hang up reason for mob number=${HANGUPCAUSE})
exten => h,n,set(CallEndDate1=${STRFTIME(${EPOCH},,%Y%m%d%H%M%S)})
exten => h,n,set(Duration=${CDR(duration)})
exten => h,n,Set(C_End=${STRFTIME(${EPOCH},,%H%M%S)})
exten => h,n,Set(ContentTime=0)
exten => h,n,Set(usr_status=1)



;exten => h,n,NoOp(Calling cinthol update current call on hangup http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_Cinthol.CINTHOL_UPDATE_CURRENTCALL&INTOKEN=2&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=0)
;exten => h,n,Set(response=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_Cinthol.CINTHOL_UPDATE_CURRENTCALL&INTOKEN=2&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=0)})
exten => h,n,NoOp(response=${response1})

exten => h,n,Set(response1=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_Cinthol.CINTHOL_RECEIVE_OBD&INTOKEN=4&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=${Duration}&INPARAM[2]=NA&INPARAM[3]=${CHANNEL})})
exten => h,n,NoOp(Calling cinthol update current call on hangup http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_Cinthol.CINTHOL_RECEIVE_OBD&INTOKEN=4&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=${Duration}&INPARAM[2]=NA&INPARAM[3]=${CHANNEL})
exten => h,n,NoOp(response1=${response1})

exten => h,n(ExitLog),Set(contentlog=${contentlog}split)
exten => h,n,NoOp(exit log url is: http://192.168.100.226:8081/hungama/Hungama_ExitLogAsterisk?starttime=${C_Start}&endtime=${C_End}&ani=${usermobno}&dnis=${realdnisdid}&realdnis=${realdnisdid}split${Section_Name}split${modesub}split${callcharge}&contenttime=${ContentTime}&circle=${circle}&operator=${operator}&service=${Service_Name}&subflag=${usr_status}&contentlog=${contentlog}&Usagelog=${Usagelog})
exten => h,n,Set(response=${CURL(http://192.168.100.226:8081/hungama/Hungama_ExitLogAsterisk?starttime=${C_Start}&endtime=${C_End}&ani=${usermobno}&dnis=${realdnisdid}&realdnis=${realdnisdid}split${Section_Name}split${modesub}split${callcharge}&contenttime=${ContentTime}&circle=${circle}&operator=${operator}&service=${Service_Name}&subflag=${usr_status}&contentlog=${contentlog}&Usagelog=${Usagelog})})
exten => h,n,Goto(discnct)
exten => h,n(discnct),hangup()


[pstn]

;MCW and TISCON Miss call process

exten => 9996,1,Set(CALLERID(num)=66785800)
exten => 9996,2,Dial(SIP/TG/07838551197)
exten => 9996,3,Hangup

exten => 9997,1,Set(CALLERID(num)=66785800)
exten => 9997,2,Dial(SIP/3002/07838551197)
exten => 9997,3,Hangup

exten => 0673,1,Set(CALLERID(num)=66785800)
exten => 0673,2,Dial(SIP/0673/88447186664)
exten => 0673,3,Hangup

exten => 0672,1,Set(CALLERID(num)=66785800)
exten => 0672,2,Dial(SIP/0672/78447186664)
exten => 0672,3,Hangup

exten => 1920,1,Set(CALLERID(num)=66785800)
exten => 1920,2,Dial(SIP/1920/58447186664)
exten => 1920,3,Hangup

exten => 3001,1,Set(CALLERID(num)=66785800)
exten => 3001,2,Dial(SIP/3001/68447186664)
exten => 3001,3,Hangup


exten => 222,1,SipAddHeader(P-Preferred-Identity: <sip:9303706@10.50.129.54>) 
exten => 222,2,Set(CALLERID(num)=1234567890)
exten => 222,3,Dial(SIP/08447186664@TATAHUL)
exten => 222,4,hangup()


exten => 000,1,SipAddHeader(P-Preferred-Identity: <sip:66785800@10.50.129.50>) 
exten => 000,2,Set(CALLERID(num)=1234567890)
exten => 000,3,Dial(SIP/09873710296@TATAHUL1)
exten => 000,4,hangup()

exten => 77777,1,Answer
exten => 77777,n,Playback(http://192.168.100.226:8080/promptFiles/summercontest/01/lang_option)
exten => 77777,n,hangup()

exten => 66785800,1,Answer
exten => 66785800,n,Set(usermobno=${dst})
exten => 66785800,n,Set(userdnis=${EXTEN})
exten => 66785800,n,Set(operator=${operator})
exten => 66785800,n,Set(circle=${circle})
exten => 66785800,n,Set(realdnis=${realdnis})
exten => 66785800,n,Set(APARTYANI=${APARTYANI})
exten => 66785800,n,Set(CallFrom=${CallFrom})

exten => 66785800,n,GotoIf($[ $[ "${CallFrom}" = "MCW" ] | $[ "${CallFrom}" = "MCWSONGDEDICATE" ] ]?MCDOWELL:TISCON)

;exten => 66785800,n,GotoIf($[ "${CallFrom}" = "MCW" ]?MCDOWELL:TISCON)

exten => 66785800,n(MCDOWELL),Goto(mcw,66785800,1)
exten => 66785800,n(TISCON),Goto(mcw,101,1)
exten => 66785800,n,hangup()

;McDowell Promotion OBD Process on exten 103

exten => 103,1,Answer
exten => 103,n,Set(usermobno=${dst})
exten => 103,n,Set(operator=${operator})
exten => 103,n,Set(circle=${circle})
exten => 103,n,Set(isMCWPromo=1)
exten => 103,n,Set(isAgeVerify=-1)
exten => 103,n,NoOp(This is promotion Call)
exten => 103,n,Goto(mcw,66785800,fromMCWPromo)
exten => 103,n,hangup()


;Cinthol OBD promotion

exten => 190,1,Answer
exten => 190,n,Set(usermobno=${dst})
exten => 190,n,Set(userdnis=${EXTEN})
exten => 190,n,Set(operator=${operator})
exten => 190,n,Set(circle=${circle})
exten => 190,n,Set(realdnisdid=190)

;exten => 190,n,Set(responsecircle=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=JBOX_GET_CIR_OPR&INTOKEN=2&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=1)})
;exten => 190,n,NoOp(calling url http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=JBOX_GET_CIR_OPR&INTOKEN=2&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=1)
;exten => 190,n,NoOp(response:${responsecircle})
;exten => 190,n,Set(operator=${CUT(responsecircle,',2)})
;exten => 190,n,Set(circle=${CUT(responsecircle,',4)})

;ContentLogging
exten => 190,n(cintholcontentloging),set(CallStartDate=${STRFTIME(${EPOCH},,%F %T)})
exten => 190,n,set(CallStartDate1=${STRFTIME(${EPOCH},,%Y-%m-%dn%H:%M:%S)})
exten => 190,n,Set(C_Start=${STRFTIME(${EPOCH},,%H%M%S)})
exten => 190,n,Set(StartDate=${STRFTIME(${EPOCH},,%Y%m%d)})
exten => 190,n,Set(modesub=OBD)
exten => 190,n,Set(callcharge=0)
exten => 190,n,Set(Section_Name=Wel_CintholOBD)
exten => 190,n,Set(Service_Name=Cinthol_OBD)
exten => 190,n,Set(Usagelog=${usermobno}split${userdnis}split${StartDate}split${C_Start}splitcall_connectsplitWel_CintholOBDsplit)
;ContentLoggingEnd

exten => 190,n(Cintholflow),Goto(playcinthol,190,1)


exten => failed,1,NoOp(obd call made on : ${dst})
exten => failed,n,NoOp(DIALSTATUS:${DIALSTATUS})
exten => failed,n,NoOp(HANGUPCAUSE:${HANGUPCAUSE})
exten => failed,n,NoOp(REASON:${REASON})
exten => failed,n,Set(status=Failed)
exten => failed,n,Set(SIPHEADER=${SIPHEADER})
exten => failed,n,Set(ID=${ID})
exten => failed,n,Set(CallFrom=${CallFrom})
exten => failed,n,Set(DIALSTATUS=${DIALSTATUS} for mob number ${dst})


exten => failed,n,GotoIf($[ $[ "${CallFrom}" = "MCW" ] & $[ "${dst}" != "" ] ]?MCW:ChkTiscon)
exten => failed,n(MCW),NoOp(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCDOWELL_MISSEDCALL_DETAILSNEW&INTOKEN=6&OUTTOKEN=0&INPARAM[0]=${dst}&INPARAM[1]=${REASON}&INPARAM[2]=LOG_FAIL&INPARAM[3]=${SIPHEADER}&INPARAM[4]=${ID}&INPARAM[5]=${realdnis})
exten => failed,n,Set(MCDResponse=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCDOWELL_MISSEDCALL_DETAILSNEW&INTOKEN=6&OUTTOKEN=0&INPARAM[0]=${dst}&INPARAM[1]=${REASON}&INPARAM[2]=LOG_FAIL&INPARAM[3]=${SIPHEADER}&INPARAM[4]=${ID}&INPARAM[5]=${realdnis})})

exten => failed,n(ChkTiscon),GotoIf($[ $[ "${CallFrom}" = "TISCON" ] & $[ "${dst}" != "" ] ]?Tiscon:ChkMCWPROMO)
exten => failed,n(Tiscon),NoOp(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.TATA_MISSSEDCALL_UPDATENEW&INTOKEN=6&OUTTOKEN=0&INPARAM[0]=${dst}&INPARAM[1]=${REASON}&INPARAM[2]=LOG_FAIL&INPARAM[3]=${CHANNEL}&INPARAM[4]=${ID}&INPARAM[5]=${realdnis})
exten => failed,n,Set(TISCONResponse=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.TATA_MISSSEDCALL_UPDATENEW&INTOKEN=6&OUTTOKEN=0&INPARAM[0]=${dst}&INPARAM[1]=${REASON}&INPARAM[2]=LOG_FAIL&INPARAM[3]=${CHANNEL}&INPARAM[4]=${ID}&INPARAM[5]=${realdnis})})
exten => failed,n(failedhang),hangup()

exten => failed,n(ChkMCWPROMO),GotoIf($[ $[ "${CallFrom}" = "MCWPROMO" ] & $[ "${dst}" != "" ] ]?MCWPROMO:ChkMCWSONGDedicate)
exten => failed,n(MCWPROMO),NoOp(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCDOWELL_PROMOTIONCALL_DETAILS&INTOKEN=4&OUTTOKEN=0&INPARAM[0]=${dst}&INPARAM[1]=${REASON}&INPARAM[2]=LOG_FAIL&INPARAM[3]=${SIPHEADER})
exten => failed,n,Set(MCWPROMOResponse=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCDOWELL_PROMOTIONCALL_DETAILS&INTOKEN=4&OUTTOKEN=0&INPARAM[0]=${dst}&INPARAM[1]=${REASON}&INPARAM[2]=LOG_FAIL&INPARAM[3]=${SIPHEADER})})
exten => failed,n(failedhang),hangup()

exten => failed,n(ChkMCWSONGDedicate),GotoIf($[ $[ "${CallFrom}" = "MCWSONGDEDICATE" ] & $[ "${dst}" != "" ] ]?MCWSONGDedicate:ChkCINTHOLPROMO)
exten => failed,n(MCWSONGDedicate),NoOp(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCDOWELL_MISSEDCALL_SONGDEDICATE_DETAILS&INTOKEN=6&OUTTOKEN=0&INPARAM[0]=${dst}&INPARAM[1]=${REASON}&INPARAM[2]=LOG_FAIL&INPARAM[3]=${SIPHEADER}&INPARAM[4]=${ID}&INPARAM[5]=${realdnis})
exten => failed,n,Set(MCWSONGDedicate=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCDOWELL_MISSEDCALL_SONGDEDICATE_DETAILS&INTOKEN=6&OUTTOKEN=0&INPARAM[0]=${dst}&INPARAM[1]=${REASON}&INPARAM[2]=LOG_FAIL&INPARAM[3]=${SIPHEADER}&INPARAM[4]=${ID}&INPARAM[5]=${realdnis})})
exten => failed,n(failedhang),hangup()

exten => failed,n(ChkCINTHOLPROMO),GotoIf($[ $[ "${CallFrom}" = "CINTHOLPROMO" ] & $[ "${dst}" != "" ] ]?CINTHOLPROMO:failedhang)

exten => failed,n(CINTHOLPROMO),NoOp(obd call made on : ${dst})
exten => failed,n,NoOp(DIALSTATUS:${DIALSTATUS})
exten => failed,n,NoOp(HANGUPCAUSE:${HANGUPCAUSE})
exten => failed,n,NoOp(REASON:${REASON})
exten => failed,n,Set(status=Failed)
exten => failed,n,Set(SIPHEADER=${SIPHEADER})
exten => failed,n,Set(ID=${ID})
exten => failed,n,Set(CallFrom=${CallFrom})

exten => failed,n(Cinthol),NoOp(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_Cinthol.CINTHOL_UPDATE_FAILEDCALL&INTOKEN=5&OUTTOKEN=0&INPARAM[0]=${dst}&INPARAM[1]=${REASON}&INPARAM[2]=LOG_FAIL&INPARAM[3]=${SIPHEADER}&INPARAM[4]=${ID})
exten => failed,n,Set(CintholResponse=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_Cinthol.CINTHOL_UPDATE_FAILEDCALL&INTOKEN=5&OUTTOKEN=0&INPARAM[0]=${dst}&INPARAM[1]=${REASON}&INPARAM[2]=LOG_FAIL&INPARAM[3]=${SIPHEADER}&INPARAM[4]=${ID})})
exten => failed,n(failedhang),hangup()



[mcw1]

;IdeaAD
exten => 66785800,1,Answer
exten => 66785800,n,Set(userdnis=${EXTEN})
exten => 66785800,n,Set(usermobno=${CALLERID(num)})
exten => 66785800,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/IdeaAD/Welcome${RAND(1,2)})
exten => 66785800,n(playsection),NoOp(Call received from  ${usermobno})
exten => 66785800,n,Read(rootmenu,/var/lib/apache-tomcat-6.0.29/webapps/hungama/IdeaAD/rootmenu,1,,,5)
exten => 66785800,n,GotoIf($[ "${rootmenu}" = "1" ]?HinBollyPlayContent)
exten => 66785800,n,GotoIf($[ "${rootmenu}" = "2" ]?BollyAllTimesPlayContent)
exten => 66785800,n,GotoIf($[ "${rootmenu}" = "3" ]?BhopLokPlayContent)
exten => 66785800,n,GotoIf($[ "${rootmenu}" = "4" ]?BhaktiRasPlayContent)
exten => 66785800,n,Goto(playsection)

exten => 66785800,n(HinBollyPlayContent),Set(PlayContentConf=HinBolly)
exten => 66785800,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/IdeaAD/HindiBollywood)
exten => 66785800,n,Goto(CallContent)

exten => 66785800,n(BollyAllTimesPlayContent),Set(PlayContentConf=BollyAllTimes)
exten => 66785800,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/IdeaAD/BollywoodAllTimes)
exten => 66785800,n,Goto(CallContent)

exten => 66785800,n(BhopLokPlayContent),Set(PlayContentConf=BhopLok)
exten => 66785800,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/IdeaAD/BhojpuriLokpriya)
exten => 66785800,n,Goto(CallContent)

exten => 66785800,n(BhaktiRasPlayContent),Set(PlayContentConf=BhaktiRasPlay)
;exten => 66785800,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/IdeaAD/BhaktiRaas)
exten => 66785800,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/IdeaAD/BollywoodAllTimes)

;Fetching content from config file
exten => 66785800,n(CallContent),NoOp(calling url for mobile no:${usermobno} http://192.168.100.226:8081/hungama/ar_ReadConfigSongAsterisk?ConfigPath=IdeaAd/${PlayContentConf}.cfg&TOKEN=FREE)
exten => 66785800,n,Set(getsongslist=${CURL(http://192.168.100.226:8081/hungama/ar_ReadConfigSongAsterisk?ConfigPath=IdeaAd/${PlayContentConf}.cfg&TOKEN=FREE)})
exten => 66785800,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/IdeaAD/keyinfo)
exten => 66785800,n,Macro(PlayIdeaContent,${usermobno},${userdnis},${getsongslist})




exten => 66291351,1,Answer
exten => 66291351,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/msw_age)
exten => 66291351,n,hangup

exten => 222,1,SipAddHeader(P-Preferred-Identity: <sip:9303706@10.50.129.54>) 
exten => 222,2,Progress()
exten => 222,3,Dial(SIP/08447186664@TATAHUL)
exten => 222,4,hangup()

exten => _9303706,1,Hangup()



exten => 66785800,1,Progress()
exten => 66785800,n,Set(pseudodid=${SIP_HEADER(From)})
exten => 66785800,n,Set(pseudodid1=${SIP_HEADER(To)})
exten => 66785800,n,Set(did=${CUT(pseudodid1,<,-1)})
exten => 66785800,n,NoOp(Call received from  ${pseudodid})
exten => 66785800,n,Set(userdnis=${EXTEN})
exten => 66785800,n,Set(usermo=${CALLERID(num)})
exten => 66785800,n,Set(chanpart=${CUT(CHANNEL,-,-1)})
exten => 66785800,n,NoOp(Call received on sip channel  ${CHANNEL} and channel part is ${chanpart} from ${usermo})
exten => 66785800,n,GotoIf($[ ${did} = "9910040744" ]?tisconmisscall:checkgsk)
exten => 66785800,n(checkgsk),GotoIf($[ ${did} = "9555120000" ]?gskmisscall:checkprompttest)
;exten => 66785800,n(checkgsk),GotoIf($[ ${did} = "9540249112" ]?gskmisscall:checkprompttest)
exten => 66785800,n(checkprompttest),GotoIf($[ ${did} = "1166785811" ]?processprompttest:processnormal)
;/var/lib/apache-tomcat-6.0.29/webapps/hungama/content/Mcdowell/795_HUN-54646-0059017
;exten => 66785800,n(wronginputsong),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/content/Mcdowell/795_HUN-54646-0059016)
;exten => 66785800,n,,Set(caller=${CUT(pseudodid,<,-1)})
;exten => 66785800,n(exten),Background(vm-enter-num-to-call)
exten => 66785800,n(gskmisscall),WaitExten(4)
;exten => 66785800,n(goodbye),Playback(vm-goodbye)
exten => 66785800,n,NoOp(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_GSK_Africa.GSK_MISSSEDCALL_UPDATE&INTOKEN=3&OUTTOKEN=0&INPARAM[0]=${usermo}&INPARAM[1]=1&INPARAM[2]=0)
exten => 66785800,n,Set(lastheardmain=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_GSK_Africa.GSK_MISSSEDCALL_UPDATE&INTOKEN=3&OUTTOKEN=0&INPARAM[0]=${usermo}&INPARAM[1]=1&INPARAM[2]=0)})
exten => 66785800,n(end),Hangup()

exten => 66785800,n(tisconmisscall),NoOp(tisconmisscall process)
;exten => 66785800,n(tisconmisscall),WaitExten(2)
exten => 66785800,n(end),Hangup()

exten => 66785800,n(processprompttest),NoOp(call received for prompt test app)
exten => 66785800,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/content/testprompt/1)
exten => 66785800,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/content/testprompt/2)
exten => 66785800,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/content/testprompt/3)
exten => 66785800,n,Hangup()


exten => 66785800,n(processnormal),NoOp(Call received from  ${pseudodid})
exten => 66785800,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/McDowell_Capsule-01)
exten => 66785800,n,Set(CNT=1)
exten => 66785800,n(play),Read(songkey,/var/lib/apache-tomcat-6.0.29/webapps/hungama/test/${CNT},1,,,1)
exten => 66785800,n,Set(CNT=$[${CNT}+1])
exten => 66785800,n(ageretrycheck),GotoIf( $[ ${CNT} > 5]?Init:play)
exten => 66785800,n(Init),Set(CNT=1)
exten => 66785800,n,Goto(play)

exten => 66785800,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/test/Hun-14-64598&/var/lib/apache-tomcat-6.0.29/webapps/hungama/test/Hun-14-64115&/var/lib/apache-tomcat-6.0.29/webapps/hungama/test/Hun-14-64116&/var/lib/apache-tomcat-6.0.29/webapps/hungama/test/Hun-14-64471&/var/lib/apache-tomcat-6.0.29/webapps/hungama/test/Hun-14-64634)

; for reeju .. put all song here ... in read
;exten => 66785800,n(exten),Background(vm-enter-num-to-call)
;exten => 66785800,n,WaitExten(5)
;exten => 66785800,n(goodbye),Playback(vm-goodbye)
exten => 66785800,n(end),Hangup()


exten => 66785801,1,Set(pseudodid=${SIP_HEADER(From)})
exten => 66785801,n,Set(pseudodid1=${SIP_HEADER(To)})
exten => 66785801,n,NoOp(Call received from  ${pseudodid})
exten => 66785801,n(exten),Background(vm-enter-num-to-call)
exten => 66785801,n,WaitExten(5)
exten => 66785801,n(goodbye),Playback(vm-goodbye)
exten => 66785801,n(end),Hangup()

exten => 104,1(maxobd),NoOp(Welcome to MAXlife OBD Flow)
;get username from max API
exten => 104,n,Set(maxusernamestr=${CURL(http://192.168.100.212/hungamacare/igenius/register.php?msisdn=${usermo}&childno=1&IsRecorded=0)})
exten => 104,n,Set(userpart=${CUT(maxusernamestr,',-1)})
exten => 104,n,Set(username=${CUT(maxusernamestr,',2)})
exten => 104,n,GotoIf($[ "${username}" = "0" ]?processflow:checkuserstatus)

exten => 104,n(checkuserstatus),Set(maxstatusstr=${CURL(http://192.168.100.212/hungamacare/igenius/callCheckStatus.php?msisdn=${usermo}&uid=${username})})
exten => 104,n,NoOp(status is ${maxstatusstr})


exten => 104,n(processflow),Set(iNumRand=${RAND(1,1000)})
exten => 104,n,Set(iNumcheck=${MATH(${iNumRand}%2,int)})
exten => 104,n,GotoIf($[ "${iNumcheck}" = "0" ]?maxobdflow1:maxobdflow2)
exten => 104,n(maxobdflow1),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/maxlifeobd/01/welcome)
exten => 104,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/maxlifeobd/01/record_option)
exten => 104,n,Read(hashkey,/var/lib/apache-tomcat-6.0.29/webapps/hungama/maxlifeobd/01/beep,1,,,5)
exten => 104,n,GotoIf($[ "${hashkey}" = "#" ]?recordobd:hashagain)

exten => 104,n(hashagain),Read(hashkey,/var/lib/apache-tomcat-6.0.29/webapps/hungama/maxlifeobd/01/record_delay_option,1,,,5)

exten => 104,n(recordobd),Record(mymessage:wav,0,60)
exten => 104,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/maxlifeobd/01/listen_recording)
exten => 104,n,Read(hashkey,mymessage,1,,,3)
exten => 104,n,GotoIf($[ "${hashkey}" = "#" ]?savrec:recordobd)

exten => 104,n(maxobdflow2),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/maxlifeobd/01/favsong)
exten => 104,n(recordobdflow2),Record(mymessage_${usermo}:wav,0,60)

;hit max api to send sms 
exten => 104,n(savrec),Set(maxusernamestr=${CURL(http://192.168.100.212/hungamacare/igenius/register.php?msisdn=${usermo}&childno=1&IsRecorded=1)})
exten => 104,n,Set(userpart=${CUT(maxusernamestr,',-1)})
exten => 104,n,Set(username=${CUT(maxusernamestr,',2)})
;sav into DB
exten => 104,n,Set(updatedatetime=${URIENCODE(${STRFTIME(${EPOCH},,%Y-%m-%d %H:%M:%S)})})
exten => 104,n,Set(recfilename=Maxlife_${STRFTIME(${EPOCH},,%Y%m%d_%H%M%S)}_${usermo}.wav)
exten => 104,n,Set(recpath=/var/lib/apache-tomcat-6.0.29/webapps/hungama/maxlifeobd/rec)
exten => 104,n,System(/bin/mv /var/lib/asterisk/sounds/mymessage_${usermo}.wav /var/lib/apache-tomcat-6.0.29/webapps/hungama/maxlifeobd/rec/${recfilename})

exten => 104,n,NoOp(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Maxlife_IGenius.MaxLife_UPDATERECORDINGNEW_OBD&INTOKEN=7&OUTTOKEN=0&INPARAM[0]=${usermo}&INPARAM[1]=CHILD1&INPARAM[2]=${recfilename}&INPARAM[3]=${recpath}&INPARAM[4]=1&INPARAM[5]=1&INPARAM[6]=${username})
exten => 104,n,Set(lastheardmain=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Maxlife_IGenius.MaxLife_UPDATERECORDINGNEW_OBD&INTOKEN=7&OUTTOKEN=0&INPARAM[0]=${usermo}&INPARAM[1]=CHILD1&INPARAM[2]=${recfilename}&INPARAM[3]=${recpath}&INPARAM[4]=1&INPARAM[5]=1&INPARAM[6]=${username})})
;now hit submit API
exten => 104,n,NoOp(http://192.168.100.212/hungamacare/igenius/callAddDetails.php?msisdn=${usermo}&uid=${username}&filepath=${recfilename}&dtime=${updatedatetime})
exten => 104,n,Set(maxstatusstr=${CURL(http://192.168.100.212/hungamacare/igenius/callAddDetails.php?msisdn=${usermo}&uid=${username}&filepath=${recfilename}&dtime=${updatedatetime})})
;http://192.168.100.212/hungamacare/igenius/callAddDetails.php?msisdn=8587800665&uid=1234&filepath=&dtime=

exten => 104,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/maxlifeobd/01/thanks_recording)
exten => 104,n,Hangup()





exten => h,1(hangingcall),NoOp(hangup)
exten => h,n,GotoIf($[ ${did} = "9910040744" ]?tisconhang:normalhang)
exten => h,n(tisconhang),NoOp(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.TATA_MISSSEDCALL_UPDATE&INTOKEN=4&OUTTOKEN=0&INPARAM[0]=${usermo}&INPARAM[1]=1&INPARAM[2]=0&INPARAM[3]=${CHANNEL})
exten => h,n,Set(lastheardmain=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.TATA_MISSSEDCALL_UPDATE&INTOKEN=4&OUTTOKEN=0&INPARAM[0]=${usermo}&INPARAM[1]=1&INPARAM[2]=0&INPARAM[2]=0&INPARAM[3]=${CHANNEL})})
exten => h,n(normalhang),NoOp(hangup)



;exten => h,1,GotoIf($[ ${did} = "9910040744" ]?tisconmisscallhangup:checkgskhangup)
;exten => h,n(checkgskhangup),GotoIf($[ ${did} = "9540249112" ]?gskmisscallhangup:outhangup)

;exten => h,n(tisconmisscallhangup),NoOp(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.TATA_MISSSEDCALL_UPDATE&INTOKEN=4&OUTTOKEN=0&INPARAM[0]=${usermo}&INPARAM[1]=1&INPARAM[2]=0&INPARAM[3]=${CHANNEL})
;exten => h,n,Set(lastheardmain=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.TATA_MISSSEDCALL_UPDATE&INTOKEN=4&OUTTOKEN=0&INPARAM[0]=${usermo}&INPARAM[1]=1&INPARAM[2]=0&INPARAM[3]=${CHANNEL})})
;exten => h,n,Goto(outhangup)

;exten => h,n(gskmisscallhangup),NoOp(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_GSK_Africa.GSK_MISSSEDCALL_UPDATE&INTOKEN=3&OUTTOKEN=0&INPARAM[0]=${usermo}&INPARAM[1]=1&INPARAM[2]=0)
;exten => h,n,Set(lastheardmain=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_GSK_Africa.GSK_MISSSEDCALL_UPDATE&INTOKEN=3&OUTTOKEN=0&INPARAM[0]=${usermo}&INPARAM[1]=1&INPARAM[2]=0)})

;exten => h,n(outhangup),NoOp(This is testing of hangup for incoming)




[mcw2]

exten => 66291351,1,Answer
exten => 66291351,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/msw_age)
exten => 66291351,n,hangup

;exten => 222,n,Dial(SIP/9303706/08130335773)

exten => 222,1,SipAddHeader(P-Preferred-Identity: <sip:66785800@10.50.129.50>) 
;exten => 222,2,Progress()
exten => 222,2,Set(CALLERID(num)=1234567890)
exten => 222,3,Dial(SIP/08447186664@TATAHUL1)
exten => 222,4,hangup()

exten => _66785800,1,Hangup()

exten => 222,n,NoOp(Dial status:${DIALSTATUS})
exten => 222,n,hangup

[tisconmissedcall]
exten => 33231001,1,Progress()
exten => 33231001,n,Set(pseudodid=${SIP_HEADER(From)})
exten => 33231001,n,Set(pseudodid1=${SIP_HEADER(To)})
exten => 33231001,n,Set(did=${CUT(pseudodid1,<,-1)})
exten => 33231001,n,NoOp(Call received from  ${pseudodid})
exten => 33231001,n,Set(userdnis=${EXTEN})
exten => 33231001,n,Set(usermo=${CALLERID(num)})
exten => 33231001,n,NoOp(Call received from  ${usermo})
exten => 33231001,n,WaitExten(4)
exten => 33231001,n,Set(lastheardmain=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.TATA_MISSSEDCALL_UPDATE&INTOKEN=4&OUTTOKEN=0&INPARAM[0]=${usermo}&INPARAM[1]=1&INPARAM[2]=0&INPARAM[2]=0&INPARAM[3]=${CHANNEL})})
exten => 33231001,n,hangup()

[mcdowellsmissedcalll]
exten => 33231000,1,Progress()
exten => 33231000,n,Set(pseudodid=${SIP_HEADER(From)})
exten => 33231000,n,Set(pseudodid1=${SIP_HEADER(To)})
exten => 33231000,n,Set(did=${CUT(pseudodid1,<,-1)})
exten => 33231000,n,NoOp(Call received from  ${pseudodid})
exten => 33231000,n,Set(userdnis=${EXTEN})
exten => 33231000,n,Set(usermo=${CALLERID(num)})
exten => 33231000,n,NoOp(Call received from  ${usermo})
exten => 33231000,n,WaitExten(4)
exten => 33231000,n,Set(lastheardmain=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCDOWELL_MISSEDCALL_DETAILS&INTOKEN=4&OUTTOKEN=0&INPARAM[0]=${usermo}&INPARAM[1]=33231000&INPARAM[2]=0&INPARAM[3]=${CHANNEL})})
exten => 33231000,n,hangup()


exten => 30781982,1,Progress()
exten => 30781982,n,Set(pseudodid=${SIP_HEADER(From)})
exten => 30781982,n,Set(pseudodid1=${SIP_HEADER(To)})
exten => 30781982,n,Set(did=${CUT(pseudodid1,<,-1)})
exten => 30781982,n,NoOp(Call received from  ${pseudodid})
exten => 30781982,n,Set(userdnis=${EXTEN})
exten => 30781982,n,Set(usermo=${CALLERID(num)})
exten => 30781982,n,NoOp(Call received from  ${usermo})
exten => 30781982,n,WaitExten(4)
exten => 30781982,n,Set(lastheardmain=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.TATA_MISSSEDCALL_UPDATE&INTOKEN=4&OUTTOKEN=0&INPARAM[0]=${usermo}&INPARAM[1]=1&INPARAM[2]=0&INPARAM[2]=0&INPARAM[3]=${CHANNEL})})
exten => 30781982,n,hangup()


exten => h,1,NoOp(test call on 33231001 hangup)
exten => h,n(discnct),hangup

[gskmissedcall]
exten => 33231002,1,Progress()
exten => 33231002,n,Set(pseudodid=${SIP_HEADER(From)})
exten => 33231002,n,Set(pseudodid1=${SIP_HEADER(To)})
exten => 33231002,n,Set(did=${CUT(pseudodid1,<,-1)})
exten => 33231002,n,NoOp(Call received from  ${pseudodid})
exten => 33231002,n,Set(userdnis=${EXTEN})
exten => 33231002,n,Set(usermo=${CALLERID(num)})
exten => 33231002,n,NoOp(Call received from  ${usermo})
exten => 33231002,n,WaitExten(4)
exten => 33231002,n,Set(lastheardmain=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_GSK_Africa.GSK_MISSSEDCALL_UPDATE&INTOKEN=3&OUTTOKEN=0&INPARAM[0]=${usermo}&INPARAM[1]=1&INPARAM[2]=0)})
exten => 33231002,n,hangup()


exten => h,1,NoOp(test call on 33231002 hangup)
exten => h,n(discnct),hangup

[calldrop]
exten => 222,a,hangup()

[mcw]


exten => 222,1,SipAddHeader(P-Preferred-Identity: <sip:9303706@10.50.129.54>) 
exten => 222,2,Progress()
exten => 222,3,Dial(SIP/08447186664@TATAHUL)
exten => 222,4,hangup()



;this is for reliance missed call testing - rahul
exten => 33231001,1,Goto(tisconmissedcall,33231001,1)
exten => 33231920,1,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/Cinthol/hin/OBD_HIN)
;exten => 33231920,1,Goto(mcw,66785800,1)
exten => 33231830,1,Goto(tisconmissedcall,33231001,1)

exten => 33231002,1,Goto(gskmissedcall,33231002,1)

exten => 33231003,1(processprompttest),NoOp(call received for prompt test app)
exten => 33231003,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/Cinthol/hin/OBD_HIN)
exten => 33231003,n,Set(userdnis=isdn:30485716)
exten => 33231003,n,Hangup()

;exten => 33231001,1,Progress()
;exten => 33231001,n,Set(pseudodid=${SIP_HEADER(From)})
;exten => 33231001,n,Set(pseudodid1=${SIP_HEADER(To)})
;exten => 33231001,n,Set(did=${CUT(pseudodid1,<,-1)})
;exten => 33231001,n,NoOp(Call received from  ${pseudodid})
;exten => 33231001,n,Set(userdnis=${EXTEN})
;exten => 33231001,n,Set(usermo=${CALLERID(num)})
;exten => 33231001,n,NoOp(Call received from  ${usermo})
;exten => 33231001,n,Set(lastheardmain=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.TATA_MISSSEDCALL_UPDATE&INTOKEN=4&OUTTOKEN=0&INPARAM[0]=${usermo}&INPARAM[1]=1&INPARAM[2]=0&INPARAM[2]=0&INPARAM[3]=${CHANNEL})})
;exten => 33231001,n,hangup()

exten => 33231890,1,Set(userdnis=isdn:30485716)
exten => 33231890,n,hangup()

;exten => 33231000,1,Set(userdnis=isdn:30485716)
exten => 33231000,1,Goto(mcdowellsmissedcalll,33231000,1)
exten => 33231000,n,hangup()

exten => 222,1,SipAddHeader(P-Preferred-Identity: <sip:9303706@10.50.129.54>) 
exten => 222,n,Dial(SIP/08447186664@TATAHUL)
exten => 222,n,hangup()

exten => 66291351,1,Answer
exten => 66291351,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/msw_age)
exten => 66291351,n,hangup

exten => _X.,1,Answer
exten => _X.,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/msw_age)
exten => _X.,n,hangup()

exten => 22267,1,Answer
exten => 22267,n,Set(calltime=${STRFTIME(${EPOCH},,%Y%m%d)}${STRFTIME(${EPOCH},,%H%M%S)})
exten => 22267,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/ms_age&/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/noinput)
exten => 22267,n,Set(calltime1=${STRFTIME(${EPOCH},,%Y%m%d)}${STRFTIME(${EPOCH},,%H%M%S)})
exten => 22267,n,Set(diff1=$[${calltime1} -${calltime}])
exten => 22267,n,NoOp(diff1)
exten => 22267,n,hangup

exten => 678,1,Answer()
;exten => 678,n,ControlPlayback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/msw_age,6000,*,#,1,0)
exten => 678,n,BackgroundDetect(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/msw_age,1000,2000,6000)

;exten => 678,n,NoOp(ControlPlayback status:${CPLAYBACKSTATUS})
exten => 678,n,hangup


exten => 444,1,Answer()
;exten => 444,n,Macro(Test)


;exten => 444,n(selection),Background(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/msw_age,m,,playsongMenu)

;exten => 444,n(selection),Background(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/msw_age)

;exten => 444,n,WaitExten()

;exten => 1,1,NoOp(1 pressed)
;exten => 1,n,Goto(444,selection)

exten => 444,n,NoOp(call parameter)
exten => 444,n(play),Read(songkey,/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/msw_age,1,,,1)
exten => 444,n,NoOp(songkey is ${songkey})
exten => 444,n,Goto(play)
exten => 444,n,Hangup

exten => 666,1,Answer()
exten => 666,n(playsong),NoOp(playsong section)
exten => 666,n,Read(songkey,/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/msw_age,1,,,1)
exten => 666,n,GotoIf($[ "${songkey}" = "*" ]?wronginputsong)
exten => 666,n,GotoIf($[ "${songkey}" = "" ]?wronginputsong)
exten => 666,n,GotoIf($[ "${songkey}" = "1" ]?wronginputsong)
exten => 666,n,GotoIf($[ "${songkey}" = "2" ]?wronginputsong)
exten => 666,n,GotoIf($[ "${songkey}" = "3" ]?wronginputsong)
exten => 666,n,GotoIf($[ "${songkey}" = "4" ]?wronginputsong)
exten => 666,n,GotoIf($[ "${songkey}" = "5" ]?wronginputsong)
exten => 666,n,GotoIf($[ "${songkey}" = "6" ]?wronginputsong)
exten => 666,n,GotoIf($[ "${songkey}" = "7" ]?wronginputsong)
exten => 666,n,GotoIf($[ "${songkey}" = "8" ]?wronginputsong)
exten => 666,n,GotoIf($[ "${songkey}" = "9" ]?wronginputsong)
exten => 666,n,GotoIf($[ "${songkey}" = "#" ]?wronginputsong)

exten => 666,n(wronginputsong),NoOp(Key is -----  ${songkey})
exten => 666,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/wrong)
exten => 666,n,Goto(playsong)

;Reliance MM OBD/MTS MU OBD
exten => 102,1,Answer
exten => 102,n,Set(usermo=${CALLERID(all)})
exten => 102,n,NoOp(usermo:${usermo})
exten => 102,n,Set(usermobno=${CUT(usermo,@,-1)})
exten => 102,n,Set(us=${CUT(usermo,@,2)})

exten => 102,n,Set(usermobno=${CUT(usermo,@,-1)})
exten => 102,n,Set(usermobno=${usermobno:1:10})
exten => 102,n,NoOp(usermobile number is:${usermobno})
exten => 102,n,Set(userdnis=isdn:30485716)
;exten => 102,n,Set(response=${CURL(http://192.168.100.212/reliance/relianceMM.php?msisdn=${usermobno}&mode=OBD&reqtype=1&planid=237&serviceid=1201)})
exten => 102,n,Set(lastheardmain=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=reliance_music_mania.REL_OBDCALL_UPDATE&INTOKEN=4&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=1&INPARAM[2]=0&INPARAM[3]=${CHANNEL})})
exten => 102,n,NoOp(OBD Promotion call has been picked by :${usermobno})
exten => 102,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/OBD/hun-14-64598)

exten => 102,n,hangup

;we need to play simple obd so below code is not required....
exten => 102,n,Set(rs20retry=0)
;http://omega.hungamavoice.com/reliance/relianceMM.php?msisdn=xxxxxxxx&mode=OBD&reqtype=1&planid=237&serviceid=1201
exten => 102,n(rs20retrycheck),GotoIf( $[ ${rs20retry} > 2]?nosub:rs20)

exten => 102,n(rs20),Read(songkey,/var/lib/apache-tomcat-6.0.29/webapps/hungama/REL_MM_OBD/Rs20,1,,,3)
exten => 102,n,GotoIf($[ "${songkey}" = "1" ]?rightinputsong)
exten => 102,n,GotoIf($[ "${songkey}" = "*" ]?wronginputsong)
exten => 102,n,GotoIf($[ "${songkey}" = "" ]?wronginputsong)
exten => 102,n,GotoIf($[ "${songkey}" = "2" ]?wronginputsong)
exten => 102,n,GotoIf($[ "${songkey}" = "3" ]?wronginputsong)
exten => 102,n,GotoIf($[ "${songkey}" = "4" ]?wronginputsong)
exten => 102,n,GotoIf($[ "${songkey}" = "5" ]?wronginputsong)
exten => 102,n,GotoIf($[ "${songkey}" = "6" ]?wronginputsong)
exten => 102,n,GotoIf($[ "${songkey}" = "7" ]?wronginputsong)
exten => 102,n,GotoIf($[ "${songkey}" = "8" ]?wronginputsong)
exten => 102,n,GotoIf($[ "${songkey}" = "9" ]?wronginputsong)
exten => 102,n,GotoIf($[ "${songkey}" = "#" ]?wronginputsong)

exten => 102,n(wronginputsong),Set(rs20retry=$[${rs20retry}+1])
exten => 102,n,Goto(rs20retrycheck)

exten => 102,n(rightinputsong),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/REL_MM_OBD/thank_sub)
;http://omega.hungamavoice.com/reliance/relianceMM.php?msisdn=${usermobno}&mode=OBD&reqtype=1&planid=237&serviceid=1201
exten => 102,n,Set(response=${CURL(http://192.168.100.212/reliance/relianceMM.php?msisdn=${usermobno}&mode=OBD&reqtype=1&planid=237&serviceid=1201)})
exten => 102,n,Goto(rs20hangup)

exten => 102,n(nosub),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/REL_MM_OBD/thanks_nosub)
exten => 102,n(rs20hangup),hangup



;Tiscon OBD Process

exten => 101,1,Answer()
exten => 101,n,NoOp(usermobno is:${usermobno})
exten => 101,n(checkmobnostatus),GotoIf($[ "${usermobno}" != "" ]?SetExten:setmob)

exten => 101,n(setmob),NoOp(call parameter:${VAR0})
exten => 101,n,Set(myVar=${VAR0})
exten => 101,n,Set(myVar1=${VAR1})

exten => 101,n,Set(usermo=${CALLERID(all)})
exten => 101,n,NoOp(usermo:${usermo})
exten => 101,n,Set(usermobno=${CUT(usermo,@,-1)})
exten => 101,n,Set(us=${CUT(usermo,@,2)})

exten => 101,n,Set(usermobno=${CUT(usermo,@,-1)})
exten => 101,n,Set(usermobno=${usermobno:1:10})
exten => 101,n,NoOp(usermobile number is:${usermobno})


;exten => 101,n,Set(userdnis=${EXTEN})
exten => 101,n(SetExten),Set(userdnis=isdn:30485713)
exten => 101,n,Set(ageretry=0)
exten => 101,n,Set(lang=hin)

exten => 101,n,Set(realdnisdid=${realdnis})


;ContentLogging
exten => 101,n(tisconcontentloging),set(CallStartDate=${STRFTIME(${EPOCH},,%F %T)})
exten => 101,n,set(CallStartDate1=${STRFTIME(${EPOCH},,%Y-%m-%dn%H:%M:%S)})
exten => 101,n,Set(C_Start=${STRFTIME(${EPOCH},,%H%M%S)})
exten => 101,n,Set(StartDate=${STRFTIME(${EPOCH},,%Y%m%d)})
exten => 101,n,Set(modesub=OBD)
exten => 101,n,Set(callcharge=0)
exten => 101,n,Set(Section_Name=Wel_Connect)
exten => 101,n,Set(Service_Name=TISCON)
exten => 101,n,Set(Usagelog=${usermobno}split${userdnis}split${StartDate}split${C_Start}splitcall_connectsplitWel_Tisconsplit)
;ContentLoggingEnd

exten => 101,n,NoOp(calling url http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.TISCON_USERPROFILE&INTOKEN=4&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=1&INPARAM[2]=USERSTATUS&INPARAM[3]=0)
exten => 101,n,Set(response=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.TISCON_USERPROFILE&INTOKEN=4&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=1&INPARAM[2]=USERSTATUS&INPARAM[3]=0)})
exten => 101,n,NoOp(response for mobile no ${usermobno} :${response})

exten => 101,n,Set(usr_status=${CUT(response,',2)})
exten => 101,n,Set(HEARD=${CUT(response,',4)})
exten => 101,n,Set(qno=${CUT(response,',6)})
exten => 101,n,Set(lang=${CUT(response,',8)})

exten => 101,n,NoOp(usr_status:${usr_status} and ani:${usermobno})
exten => 101,n,NoOp(HEARD:${HEARD})
exten => 101,n,NoOp(qno:${qno})
exten => 101,n,NoOp(lang for mobile no ${usermobno}:${lang})

exten => 101,n,Set(operator=${operator})
exten => 101,n,Set(circle=${circle})


;exten => 101,n,NoOp(calling url http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=JBOX_GET_CIR_OPR&INTOKEN=2&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=1)
;exten => 101,n,Set(responsecircle=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=JBOX_GET_CIR_OPR&INTOKEN=2&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=1)})
;exten => 101,n,NoOp(response:${responsecircle})

;exten => 101,n,Set(operator=${CUT(responsecircle,',2)})
;exten => 101,n,Set(circle=${CUT(responsecircle,',4)})


exten => 101,n(chkstatus),GotoIf($[ $[ "${usermobno}" = "9842301214" ] | $[ "${usermobno}" = "9711130819" ] | $[ "${usermobno}" = "8420353277"] | $[ "${usermobno}" = "7838588843"] | $[ "${usermobno}" = "9654415676"] | $[ "${usermobno}" = "9831151415"] | $[ "${usermobno}" = "9655216774"] | $[ "${usermobno}" = "9038007672"] | $[ "${usermobno}" = "8017523023" ]]?ChkUserStatus:ChkUserStatus)
exten => 101,n(ChkUserStatus),NoOp(response for mobile no is ${usermobno} :${response})
;exten => 101,n,Set(circle=kol)
exten => 101,n,GotoIf($[ "${usr_status}" = "1" ]?RepeatUser:ChkLang)

exten => 101,n(ChkLang),GotoIf($[ "${circle}" = "tnu" ]?chkLangAPD:chkBen)
exten => 101,n(chkBen),GotoIf($[ $[ "${circle}" = "kol" ] | $[ "${circle}" = "wbl" ] ]?chkLangBen:chkRestIndia)
;exten => 101,n(chkBen),GotoIf($[ "${circle}" = "kol" ]?chkLangBen:chkRestIndia)

exten => 101,n(chkLangAPD),NoOp(Tamil lang sleection)
exten => 101,n,Set(lang=tam)
exten => 101,n,Read(menu,/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/tam/Welcome_Lang&/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/tam/lang_selection,1,,,5)
exten => 101,n,GotoIf($[ "${menu}" = "1" ]?settam)
exten => 101,n,GotoIf($[ "${menu}" = "2" ]?sethin)
exten => 101,n,Goto(chkInputstatus)


exten => 101,n(chkLangBen),NoOp(Ben lang sleection)
exten => 101,n,Set(lang=ben)
exten => 101,n,Read(menu,/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/ben/Welcome_Lang&/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/ben/lang_selection,1,,,5)
exten => 101,n,GotoIf($[ "${menu}" = "1" ]?setben)
exten => 101,n,GotoIf($[ "${menu}" = "2" ]?sethin)
exten => 101,n,Goto(chkInputstatus)

exten => 101,n(chkRestIndia),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/hin/Welcome_Lang)
exten => 101,n,Set(response=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.LangUpdate&INTOKEN=2&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=${lang})})
exten => 101,n,NoOp(calling url http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.LangUpdate&INTOKEN=2&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=${lang})
exten => 101,n,Goto(FetchConfig)


exten => 101,n(ageretrycheck),GotoIf( $[ ${ageretry} > 0]?AssignLang:ChkLang)

exten => 101,n(AssignLang),GotoIf($[ "${circle}" = "tnu" ]?settam:setben)

exten => 101,n(noinput),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/${lang}/no_input)
exten => 101,n,Set(ageretry=$[${ageretry}+1])
exten => 101,n,Goto(ageretrycheck)

exten => 101,n(chkInputstatus),GotoIf($[ "${menu}" = "" ]?noinput:wrongInput)
exten => 101,n(wrongInput),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/${lang}/wrong_input)
exten => 101,n,Set(ageretry=$[${ageretry}+1])
exten => 101,n,Goto(ageretrycheck)

exten => 101,n(sethin),Set(lang=hin)
exten => 101,n,Goto(LangUpdate)

exten => 101,n(setben),Set(lang=ben)
exten => 101,n,Goto(LangUpdate)

exten => 101,n(settam),Set(lang=tam)
exten => 101,n,Goto(LangUpdate)

exten => 101,n(LangUpdate),Set(response=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.LangUpdate&INTOKEN=2&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=${lang})})
exten => 101,n,NoOp(calling url http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.LangUpdate&INTOKEN=2&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=${lang})
exten => 101,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/${lang}/lang_saved)
exten => 101,n,Goto(FetchConfig)

exten => 101,n(RepeatUser),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/${lang}/Repeat_Lang)
exten => 101,n,NoOp(lang for mobile no ${usermobno}:${lang})
exten => 101,n,Goto(FetchConfig)

exten => 101,n(PrevFlow),GotoIf($[ "${usr_status}" = "1" ]?ExistUser:chkstatus)
exten => 101,n(ExistUser),NoOp(ExistUser Flow)
exten => 101,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/welcome_generic_old)
exten => 101,n,Goto(FetchConfig)

;Fetching content from config file
exten => 101,n(FetchConfig),NoOp(calling url for mobile no:${usermobno} http://192.168.100.226:8081/hungama/ar_ReadConfigSongAsterisk?ConfigPath=Hungama_Tiscon/${lang}/Tiscon.cfg&TOKEN=FREE)
exten => 101,n,Set(getsongslist=${CURL(http://192.168.100.226:8081/hungama/ar_ReadConfigSongAsterisk?ConfigPath=Hungama_Tiscon/${lang}/Tiscon.cfg&TOKEN=FREE)})

exten => 101,n(CallPlayContent),Macro(ReadContent,${usermobno},${userdnis},localhost:8080,hungama,hul_dbinteraction,${getsongslist},/var/lib/apache-tomcat-6.0.29/webapps/hungama/content/Tiscon,${qno},${circle},${lang})

;obd application for max
exten => 104,1,Answer()
exten => 104,n,NoOp(Welcome to MAXlife OBD Flow)
exten => 104,n,Set(isMCWPromo=0)
exten => 104,n,Set(operator=unim)
exten => 104,n(fromMCWPromo),set(CallStartDate=${STRFTIME(${EPOCH},,%F %T)})
exten => 104,n,set(CallStartDate1=${STRFTIME(${EPOCH},,%Y-%m-%dn%H:%M:%S)})
exten => 104,n,Set(lang=hin)

exten => 104,n,NoOp(call parameter:${VAR0})
exten => 104,n,Set(myVar=${VAR0})
exten => 104,n,Set(myVar1=${VAR1})


exten => 104,n,Set(usermo=${CALLERID(all)})
exten => 104,n,NoOp(usermo:${usermo})

exten => 104,n,Set(usermobno=${CUT(usermo,@,-1)})
exten => 104,n,Set(us=${CUT(usermo,@,2)})

exten => 104,n,Set(usermobno=${CUT(usermo,@,-1)})

;exten => 104,n,Set(usermobno=${usermobno:1:10})
;exten => 104,n,Set(testusermobno=${usermobno:2})
;exten => 104,n,Set(testusermobno3=${usermobno:1})
;exten => 104,n,Set(testusermobno1=${usermobno:-1})


exten => 104,n,Set(usermobno=${usermobno:1:10})
exten => 104,n,NoOp(usermobile number is:${usermobno})

exten => 104,n,Set(userdnis=isdn:30485715)

exten => 104,n(getchanpart),Set(chanpart=${CUT(CHANNEL,-,-1)})
exten => 104,n,GotoIf($[ "${chanpart}" = "SIP/TATAHUL1" ]?setdiddndmaxlife:setdidnondndmaxlife)
exten => 104,n(setdiddndmaxlife),Set(realdnisdid=66785800)
exten => 104,n,Goto(maxcontentlogsection)

exten => 104,n(setdidnondndmaxlife),Set(realdnisdid=1409303706)

;ContentLogging
exten => 104,n(maxcontentlogsection),set(CallStartDate=${STRFTIME(${EPOCH},,%F %T)})
exten => 104,n,set(CallStartDate1=${STRFTIME(${EPOCH},,%Y-%m-%dn%H:%M:%S)})
exten => 104,n,Set(C_Start=${STRFTIME(${EPOCH},,%H%M%S)})
exten => 104,n,Set(StartDate=${STRFTIME(${EPOCH},,%Y%m%d)})
exten => 104,n,Set(modesub=OBD)
exten => 104,n,Set(callcharge=0)
exten => 104,n,Set(Section_Name=Wel_Connect)
exten => 104,n,Set(Usagelog=${usermobno}split${userdnis}split${StartDate}split${C_Start}splitcall_connectsplitWel_MCDOWELLsplit)
exten => 104,n,Set(Service_Name=MAXLIFE_OBD)
;ContentLoggingEnd

exten => 104,n(updatepromocurrentcall),Set(response1=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Maxlife_IGenius.MAXLIFE_UPDATE_CURRENTCALL&INTOKEN=2&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=1)})
;get username from max API .... we will do this after the recording
;exten => 104,n,Set(maxusernamestr=${CURL(http://192.168.100.212/hungamacare/igenius/register.php?msisdn=${usermobno}&childno=1&IsRecorded=0)})
;exten => 104,n,Set(userpart=${CUT(maxusernamestr,',-1)})
;exten => 104,n,Set(username=${CUT(maxusernamestr,',2)})
;exten => 104,n,GotoIf($[ "${username}" = "0" ]?processflow:checkuserstatus)

;exten => 104,n(checkuserstatus),Set(maxstatusstr=${CURL(http://192.168.100.212/hungamacare/igenius/callCheckStatus.php?msisdn=${usermobno}&uid=${username})})
;exten => 104,n,NoOp(status is ${maxstatusstr})


exten => 104,n(processflow),Set(iNumRand=${RAND(1,1000)})
exten => 104,n,Set(iNumcheck=${MATH(${iNumRand}%2,int)})
exten => 104,n,GotoIf($[ "${iNumcheck}" = "0" ]?maxobdflow1:maxobdflow2)
exten => 104,n(maxobdflow1),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/maxlifeobd/01/welcome)
exten => 104,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/maxlifeobd/01/record_option)
exten => 104,n,Read(hashkey,/var/lib/apache-tomcat-6.0.29/webapps/hungama/maxlifeobd/01/beep,1,,,5)
exten => 104,n,GotoIf($[ "${hashkey}" = "#" ]?recordobd:hashagain)

exten => 104,n(hashagain),Read(hashkey,/var/lib/apache-tomcat-6.0.29/webapps/hungama/maxlifeobd/01/record_delay_option,1,,,5)

exten => 104,n(recordobd),Record(mymessage:wav,0,60)
exten => 104,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/maxlifeobd/01/listen_recording)
exten => 104,n,Read(hashkey,mymessage,1,,,3)
exten => 104,n,GotoIf($[ "${hashkey}" = "#" ]?savrec:recordobd)

exten => 104,n(maxobdflow2),Set(iNumRand=${RAND(1,1000)})
exten => 104,n,Set(iNumcheck=${MATH(${iNumRand}%2,int)})
exten => 104,n,GotoIf($[ "${iNumcheck}" = "0" ]?playfavsong:playhello)
exten => 104,n(playfavsong),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/maxlifeobd/01/favsong)
exten => 104,n,Goto(recordobdflow2)

exten => 104,n(playhello),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/maxlifeobd/01/Hello)
exten => 104,n(recordobdflow2),Record(mymessage_${usermobno}:wav,0,60)

;hit max api to send sms 
exten => 104,n(savrec),Set(maxusernamestr=${CURL(http://192.168.100.212/hungamacare/igenius/register.php?msisdn=${usermobno}&childno=1&IsRecorded=1)})
exten => 104,n,Set(userpart=${CUT(maxusernamestr,',-1)})
exten => 104,n,Set(username=${CUT(maxusernamestr,',2)})
;sav into DB
exten => 104,n,Set(updatedatetime=${URIENCODE(${STRFTIME(${EPOCH},,%Y-%m-%d %H:%M:%S)})})
exten => 104,n,Set(recfilename=Maxlife_${STRFTIME(${EPOCH},,%Y%m%d_%H%M%S)}_${usermobno}.wav)
exten => 104,n,Set(recpath=/var/lib/apache-tomcat-6.0.29/webapps/hungama/maxlifeobd/rec)
exten => 104,n,System(/bin/mv /var/lib/asterisk/sounds/mymessage_${usermobno}.wav /var/lib/apache-tomcat-6.0.29/webapps/hungama/maxlifeobd/rec/${recfilename})

exten => 104,n,NoOp(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Maxlife_IGenius.MaxLife_UPDATERECORDINGNEW_OBD&INTOKEN=7&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=CHILD1&INPARAM[2]=${recfilename}&INPARAM[3]=${recpath}&INPARAM[4]=1&INPARAM[5]=1&INPARAM[6]=${username})
exten => 104,n,Set(lastheardmain=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Maxlife_IGenius.MaxLife_UPDATERECORDINGNEW_OBD&INTOKEN=7&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=CHILD1&INPARAM[2]=${recfilename}&INPARAM[3]=${recpath}&INPARAM[4]=1&INPARAM[5]=1&INPARAM[6]=${username})})
;now hit submit API
exten => 104,n,NoOp(http://192.168.100.212/hungamacare/igenius/callAddDetails.php?msisdn=${usermobno}&uid=${username}&filepath=${recfilename})
exten => 104,n,Set(maxstatusstr=${CURL(http://192.168.100.212/hungamacare/igenius/callAddDetails.php?msisdn=${usermobno}&uid=${username}&filepath=${recfilename})})

exten => 104,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/maxlifeobd/01/thanks_recording)
exten => 104,n,Hangup()




;McDowell Promotion OBD Process on exten 103
exten => 103,1,Answer()
exten => 103,n,Set(usermobno=)
exten => 103,n,Set(isMCWPromo=1)
exten => 103,n,Set(isAgeVerify=-1)
exten => 103,n,NoOp(This is promotion Call)
exten => 103,n,Goto(66785800,fromMCWPromo)

;McDowell OBD Process

exten => 66785800,1,Answer()
exten => 66785800,n,Set(isMCWPromo=0)
exten => 66785800,n(fromMCWPromo),set(CallStartDate=${STRFTIME(${EPOCH},,%F %T)})
exten => 66785800,n,set(CallStartDate1=${STRFTIME(${EPOCH},,%Y-%m-%dn%H:%M:%S)})
exten => 66785800,n,Set(lang=hin)
exten => 66785800,n,Set(userdnis=${EXTEN})
exten => 66785800,n,Set(ageretry=0)
exten => 66785800,n,NoOp(usermobno:${usermobno})

;exten => 66785800,n,GotoIf( $[ ${isMCWPromo} = 1]?setmob:checkmobnolen)

exten => 66785800,n(checkmobnolen),GotoIf( $[ "${usermobno}" != ""]?setrealdnismcw:setmob)
exten => 66785800,n(setmob),NoOp(call parameter:${VAR0})
exten => 66785800,n,Set(myVar=${VAR0})
exten => 66785800,n,Set(myVar1=${VAR1})


exten => 66785800,n,Set(usermo=${CALLERID(all)})
exten => 66785800,n,NoOp(usermo:${usermo})

exten => 66785800,n,Set(usermobno=${CUT(usermo,@,-1)})
exten => 66785800,n,Set(us=${CUT(usermo,@,2)})

exten => 66785800,n,Set(usermobno=${CUT(usermo,@,-1)})

;exten => 66785800,n,Set(usermobno=${usermobno:1:10})
;exten => 66785800,n,Set(testusermobno=${usermobno:2})
;exten => 66785800,n,Set(testusermobno3=${usermobno:1})
;exten => 66785800,n,Set(testusermobno1=${usermobno:-1})


exten => 66785800,n,Set(usermobno=${usermobno:1:10})
exten => 66785800,n,NoOp(usermobile number is:${usermobno})


;update current calls in MCW promotion to add msisdn
;exten => 66785800,n(chkMcdPromo),GotoIf( $[ ${isMCWPromo} = 1]?updatepromocurrentcall:getchanpart)
;exten => 66785800,n(updatepromocurrentcall),NoOp(updatepromocurrentcall)
;exten => 66785800,n(updatepromocurrentcall),Set(response1=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_UPDATE_CURRENTCALL_PROMOTION&INTOKEN=2&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=1)})

;exten => 66785800,n(getchanpart),Set(chanpart=${CUT(CHANNEL,-,-1)})
;exten => 66785800,n,GotoIf($[ "${chanpart}" = "SIP/TATAHUL1" ]?setdiddndmcw:setdidnondndmcw)
;exten => 66785800,n(setdiddndmcw),Set(realdnisdid=66785800)
;exten => 66785800,n,Goto(mcwgetcir)
;exten => 66785800,n(setdidnondndmcw),Set(realdnisdid=${realdnis})

exten => 66785800,n(setrealdnismcw),Set(realdnisdid=${realdnis})


exten => 66785800,n(mcwgetcir),Set(operator=${operator})
exten => 66785800,n,Set(circle=${circle})

;exten => 66785800,n(mcwgetcir),NoOp(calling url http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=JBOX_GET_CIR_OPR&INTOKEN=2&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=1)
;exten => 66785800,n,Set(response=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=JBOX_GET_CIR_OPR&INTOKEN=2&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=1)})
;exten => 66785800,n,NoOp(response:${response})
;exten => 66785800,n,Set(operator=${CUT(response,',2)})
;exten => 66785800,n,Set(circle=${CUT(response,',4)})

exten => 66785800,n,Set(usr_status=-1)

;ContentLogging
exten => 66785800,n,set(CallStartDate=${STRFTIME(${EPOCH},,%F %T)})
exten => 66785800,n,set(CallStartDate1=${STRFTIME(${EPOCH},,%Y-%m-%dn%H:%M:%S)})
exten => 66785800,n,Set(C_Start=${STRFTIME(${EPOCH},,%H%M%S)})
exten => 66785800,n,Set(StartDate=${STRFTIME(${EPOCH},,%Y%m%d)})
exten => 66785800,n,Set(modesub=OBD)
exten => 66785800,n,Set(callcharge=0)
exten => 66785800,n,Set(Section_Name=Wel_Connect)
exten => 66785800,n,Set(Usagelog=${usermobno}split${userdnis}split${StartDate}split${C_Start}splitcall_connectsplitWel_MCDOWELLsplit)
exten => 66785800,n,Set(Service_Name=MCW)
;ContentLoggingEnd


exten => 66785800,n(chklang),NoOp(chklang section)
;exten => 66785800,n,Goto(chkother)
exten => 66785800,n,GotoIf($[ "${circle}" = "kar" ]?setkar:chkkan)
exten => 66785800,n(setkar),NoOp(karnatka region)
exten => 66785800,n(asklanguage),Read(menu,/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/kan/SelLangKan&/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/kan/SelLangHin,1,,,10)
exten => 66785800,n,GotoIf($[ "${menu}" = "1" ]?setkarlang)
exten => 66785800,n,GotoIf($[ "${menu}" = "2" ]?chkother)
exten => 66785800,n,Goto(asklanguage)

exten => 66785800,n(setkarlang),Set(lang=kan)
exten => 66785800,n,Goto(ageretrycheck)


exten => 66785800,n(chkkan),GotoIf($[ "${circle}" = "apd" ]?settel:chkother)
exten => 66785800,n(settel),NoOp(telegu region)
exten => 66785800,n(asktellanguage),Read(menu,/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/tel/SelLangTel&/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/tel/SelLangHin,1,,,10)
exten => 66785800,n,GotoIf($[ "${menu}" = "1" ]?settellang)
exten => 66785800,n,GotoIf($[ "${menu}" = "2" ]?chkother)
exten => 66785800,n,Goto(asktellanguage)

exten => 66785800,n(settellang),Set(lang=tel)
exten => 66785800,n,Goto(ageretrycheck)

exten => 66785800,n(chkother),Set(lang=hin)

;play welcome prompt for promotion
exten => 66785800,n,GotoIf( $[ ${isMCWPromo} = 1]?playpromowel:ageretrycheck)
exten => 66785800,n(playpromowel),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/${lang}/welcome_promo)
;this section for age verification of promo calls
exten => 66785800,n,Set(iNumRand=${RAND(1,1000)})
exten => 66785800,n,Set(iNumcheck=${MATH(${iNumRand}%2,int)})
exten => 66785800,n,GotoIf($[ "${iNumcheck}" = "0" ]?promoplayageverify:promoskipageverify)
exten => 66785800,n(promoplayageverify),Set(isAgeVerify=0)
exten => 66785800,n,Read(menu,/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/${lang}/msw_age,1,,,3)
exten => 66785800,n,GotoIf($[ "${menu}" = "*" ]?setageverify:failedageverify)

exten => 66785800,n(setageverify),Set(isAgeVerify=1)
;exten => 66785800,n,Set(response1=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_AGE_VERIFIATION_PROMO&INTOKEN=2&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=1)})
exten => 66785800,n,Goto(ChkConfStatus)

;exten => 66785800,n(failedageverify),Set(response1=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_AGE_VERIFIATION_PROMO&INTOKEN=2&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=0)})
exten => 66785800,n(failedageverify),Set(isAgeVerify=0)
exten => 66785800,n,Goto(ChkConfStatus)

;exten => 66785800,n(promoskipageverify),Set(response1=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_AGE_VERIFIATION_PROMO&INTOKEN=2&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=2)})
exten => 66785800,n(promoskipageverify),Set(isAgeVerify=2)
exten => 66785800,n,NoOp(age verification skiped for : ${usermobno})
exten => 66785800,n,Goto(ChkConfStatus)


exten => 66785800,n(ageretrycheck),GotoIf( $[ ${ageretry} > 1]?endcall:selection)
exten => 66785800,n(selection),Read(menu,/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/${lang}/msw_age,1,,,3)
exten => 66785800,n,GotoIf($[ "${menu}" = "*" ]?ChkConfStatus:chkstatus)

exten => 66785800,n(noinput),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/${lang}/noinput)
exten => 66785800,n,Set(ageretry=$[${ageretry}+1])
exten => 66785800,n,Goto(ageretrycheck)

exten => 66785800,n(chkstatus),GotoIf($[ "${menu}" = "" ]?noinput:wrongInput)
exten => 66785800,n(wrongInput),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/${lang}/wrong)
exten => 66785800,n,Set(ageretry=$[${ageretry}+1])
exten => 66785800,n,Goto(ageretrycheck)

;Fetching content from config file

exten => 66785800,n(ChkConfStatus),GotoIf($[ $[ "${usermobno}" = "9017836900" ] | $[ "${usermobno}" = "9971530333" ] | $[ "${usermobno}" = "7838588843" ] | $[ "${usermobno}" = "9930128653" ] | $[ "${usermobno}" = "9711130819" ]  | $[ "${usermobno}" = "9900249912" ] | $[ "${usermobno}" = "9740381100" ] | $[ "${usermobno}" = "9740984251" ] | $[ "${usermobno}" = "9739664990" ] | $[ "${usermobno}" = "9886728640" ] | $[ "${usermobno}" = "9686629335" ] | $[ "${usermobno}" = "9740956909" ] | $[ "${usermobno}" = "9060324518" ]]?promocfgfetch:promocfgfetch)
exten => 66785800,n(promocfgfetch),GotoIf( $[ ${isMCWPromo} = 1]?fetchcfgpromo:CallFetchContentFlow)

exten => 66785800,n(TestFile),NoOp(calling url http://192.168.100.226:8081/hungama/ar_ReadConfigSongAsterisk?ConfigPath=MCDOWELLS/mcdowellsMASH.cfg&TOKEN=FREE)
exten => 66785800,n,Set(getsongslist=${CURL(http://192.168.100.226:8081/hungama/ar_ReadConfigSongAsterisk?ConfigPath=MCDOWELLS/mcdowellsMASH.cfg&TOKEN=FREE)})
exten => 66785800,n,Goto(songlist)

exten => 66785800,n(fetchcfgpromo),NoOp(calling url http://192.168.100.226:8081/hungama/ar_ReadConfigSongAsterisk?ConfigPath=MCDOWELLS/mcdowellspromo.cfg&TOKEN=FREE)
exten => 66785800,n,Set(getsongslist=${CURL(http://192.168.100.226:8081/hungama/ar_ReadConfigSongAsterisk?ConfigPath=MCDOWELLS/mcdowellspromo.cfg&TOKEN=FREE)})
exten => 66785800,n,Goto(songlist)

exten => 66785800,n(CallFetchContentFlow),NoOp(calling url http://192.168.100.226:8081/hungama/ar_ReadConfigSongAsterisk?ConfigPath=MCDOWELLS/${lang}/mcdowells.cfg&TOKEN=FREE)
exten => 66785800,n,Set(getsongslist=${CURL(http://192.168.100.226:8081/hungama/ar_ReadConfigSongAsterisk?ConfigPath=MCDOWELLS/${lang}/mcdowells.cfg&TOKEN=FREE)})

exten => 66785800,n(songlist),NoOp(getsongslistis ${getsongslist})
exten => 66785800,n,GotoIf( $[ ${isMCWPromo} = 1]?resetlastheard:fetchlastheard)

;Fetched Content from config file
exten => 66785800,n(fetchlastheard),Set(lastheardmain=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_LASTHEARD&INTOKEN=3&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=1&INPARAM[2]=0)})
exten => 66785800,n,NoOp(lastheardmain url http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_LASTHEARD&INTOKEN=3&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=1&INPARAM[2]=0)
exten => 66785800,n,NoOp(last heard is - ${lastheardmain})
exten => 66785800,n,Set(temp=${CUT(lastheardmain,',-1)})
exten => 66785800,n,Set(lastheardnum=${CUT(lastheardmain,',2)})
exten => 66785800,n,Set(lastheardcircle=${CUT(lastheardmain,',4)})
exten => 66785800,n,NoOp(last heard num is - ${lastheardnum})
exten => 66785800,n,NoOp(lastheardcircle is - ${lastheardcircle})
exten => 66785800,n,Goto(skipresetlastheard)

;if this is promotional call then no need to get last heard

exten => 66785800,n(resetlastheard),Set(lastheardnum=0)
exten => 66785800,n(skipresetlastheard),NoOp(last heared modification)

exten => 66785800,n,Set(WrongCNT=0)
exten => 66785800,n,Set(NoInputCNT=0)

exten => 66785800,n,GotoIf($[ "${CallFrom}" = "MCWSONGDEDICATE" ]?CallPlayContent:PlayBroughtPrompt)

exten => 66785800,n(PlayBroughtPrompt),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/${lang}/Sweeper01&/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/${lang}/Broughttoyouby)

exten => 66785800,n,Set(UpdateADD=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCDOWELL_ADD&INTOKEN=1&OUTTOKEN=0&INPARAM[0]=Broughttoyouby)})
exten => 66785800,n,NoOp(UpdateADD:http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCDOWELL_ADD&INTOKEN=1&OUTTOKEN=0&INPARAM[0]=Broughttoyouby)

;Playing static question only for Bihar circle
exten => 66785800,n(chkstatus),GotoIf($[ "${lastheardcircle}" = "BIH" ]?PlayBiharQuestion:CallPlayContent)
exten => 66785800,n(PlayBiharQuestion),Read(menu,/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/question,1,,,3)
exten => 66785800,n,GotoIf($[ "${menu}" = "1" ]?UpdateQues)
exten => 66785800,n,GotoIf($[ "${menu}" = "2" ]?UpdateQues)
exten => 66785800,n,GotoIf($[ "${menu}" = "" ]?NoInput)


exten => 66785800,n,GotoIf($[ "${WrongCNT}" = "2" ]?CallPlayContent:CallAgainNoMatch)
exten => 66785800,n(CallAgainNoMatch),Set(WrongCNT=$[${WrongCNT}+1])
exten => 66785800,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/wrong)
exten => 66785800,n,Goto(PlayBiharQuestion)


exten => 66785800,n(NoInput),GotoIf($[ "${NoInputCNT}" = "2" ]?CallPlayContent:CallAgainNoInput)
exten => 66785800,n(CallAgainNoInput),Set(NoInputCNT=$[${NoInputCNT}+1])
exten => 66785800,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/noinput)
exten => 66785800,n,Goto(PlayBiharQuestion)

exten => 66785800,n(UpdateQues),NoOp(Calling  update answer url is http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_STORE_ANSWER&INTOKEN=3&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=${menu}&INPARAM[2]=1)
exten => 66785800,n,Set(Calling  update answer url=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_STORE_ANSWER&INTOKEN=3&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=${menu}&INPARAM[2]=1)})


exten => 66785800,n(CallPlayContent),NoOp(CallPlayContent section)
exten => 66785800,n,Set(ISRECHARGE=0)
exten => 66785800,n,GotoIf($[ "${CallFrom}" = "MCWSONGDEDICATE" ]?PlaySongDedicatePrompt:CallPlayContentFlow)

exten => 66785800,n(PlaySongDedicatePrompt),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/${lang}/Welcomesongdedicate)
exten => 66785800,n(CallRechargeAPI),Set(RechargeAPI=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCDOWELL_DEDICATESONG_RECHARGE&INTOKEN=2&OUTTOKEN=0&INPARAM[0]=${APARTYANI}&INPARAM[1]=${usermobno})})
exten => 66785800,n,NoOp(RechargeAPI:http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCDOWELL_DEDICATESONG_RECHARGE&INTOKEN=2&OUTTOKEN=0&INPARAM[0]=${APARTYANI}&INPARAM[1]=${usermobno})
exten => 66785800,n,Set(ISRECHARGE=1)


exten => 66785800,n,GotoIf($[ "${circle}" = "kar" ]?PlayKar:chkapd)
exten => 66785800,n(chkapd),GotoIf($[ "${circle}" = "apd" ]?PlayAPD:PlayHin)

exten => 66785800,n(PlayKar),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/content/Mcdowell/803_HUN-MCD-000009&/var/lib/apache-tomcat-6.0.29/webapps/hungama/content/Mcdowell/803_HUN-MCD-000010)
exten => 66785800,n,Set(content=803_HUN-SONG-000018)
exten => 66785800,n(YariAnthomKAR),Read(menu,/var/lib/apache-tomcat-6.0.29/webapps/hungama/content/Mcdowell/803_HUN-SONG-000018,1,,,3)
exten => 66785800,n,GotoIf($[ "${menu}" = "*" ]?processstarKAR)
exten => 66785800,n,Goto(FetchContent)

exten => 66785800,n(processstarKAR),Set(lastheardset=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_RNGMENU&INTOKEN=5&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=${songId}&INPARAM[2]=DEL&INPARAM[3]=rel&INPARAM[4]=PROCESS)})
exten => 66785800,n,NoOp(Ringtone menu:http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_RNGMENU&INTOKEN=5&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=${songId}&INPARAM[2]=DEL&INPARAM[3]=rel&INPARAM[4]=PROCESS)
exten => 66785800,n,Goto(YariAnthomKAR)

exten => 66785800,n(PlayAPD),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/content/Mcdowell/804_HUN-MCD-000020&/var/lib/apache-tomcat-6.0.29/webapps/hungama/content/Mcdowell/804_HUN-MCD-000021)
exten => 66785800,n,Set(content=804_HUN-SONG-000028)
exten => 66785800,n(YariAnthomAPD),Read(menu,/var/lib/apache-tomcat-6.0.29/webapps/hungama/content/Mcdowell/804_HUN-SONG-000028,1,,,3)
exten => 66785800,n,GotoIf($[ "${menu}" = "*" ]?processstarAPD)
exten => 66785800,n,Goto(FetchContent)

exten => 66785800,n(processstarAPD),Set(lastheardset=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_RNGMENU&INTOKEN=5&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=${songId}&INPARAM[2]=DEL&INPARAM[3]=rel&INPARAM[4]=PROCESS)})
exten => 66785800,n,NoOp(Ringtone menu:http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_RNGMENU&INTOKEN=5&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=${songId}&INPARAM[2]=DEL&INPARAM[3]=rel&INPARAM[4]=PROCESS)
exten => 66785800,n,Goto(YariAnthomAPD)


exten => 66785800,n(PlayHin),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/content/Mcdowell/803_HUN-MCD-000007&/var/lib/apache-tomcat-6.0.29/webapps/hungama/content/Mcdowell/803_HUN-54646-0059860)
exten => 66785800,n,Set(content=803_HUN-SONG-000008)
exten => 66785800,n(YariAnthomHIN),Read(menu,/var/lib/apache-tomcat-6.0.29/webapps/hungama/content/Mcdowell/803_HUN-SONG-000008,1,,,3)
exten => 66785800,n,GotoIf($[ "${menu}" = "*" ]?processstarHIN)
exten => 66785800,n,Goto(FetchContent)

exten => 66785800,n(processstarHIN),Set(lastheardset=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_RNGMENU&INTOKEN=5&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=${songId}&INPARAM[2]=DEL&INPARAM[3]=rel&INPARAM[4]=PROCESS)})
exten => 66785800,n,NoOp(Ringtone menu:http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_RNGMENU&INTOKEN=5&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=${songId}&INPARAM[2]=DEL&INPARAM[3]=rel&INPARAM[4]=PROCESS)
exten => 66785800,n,Goto(YariAnthomHIN)

exten => 66785800,n(FetchContent),NoOp(calling url http://192.168.100.226:8081/hungama/ar_ReadConfigSongAsterisk?ConfigPath=MCDOWELLS/${lang}/mcdowelsongedeication.cfg&TOKEN=FREE)
exten => 66785800,n,Set(getsongslist=${CURL(http://192.168.100.226:8081/hungama/ar_ReadConfigSongAsterisk?ConfigPath=MCDOWELLS/${lang}/mcdowelsongedeication.cfg&TOKEN=FREE)})

exten => 66785800,n(CallPlayContentFlow),Macro(PlayContentNew,${usermobno},${userdnis},localhost:8080,hungama,hul_dbinteraction,${getsongslist},/var/lib/apache-tomcat-6.0.29/webapps/hungama/content/Mcdowell,${lastheardnum},${lang})

exten => 66785800,n(endcall),hangup()

;At call hangup updating duration etc in table





exten => h,1(hangingcall),set(CallEndDate=${STRFTIME(${EPOCH},,%F %T)})
exten => h,n,NoOp(hang up reason for mob number=${HANGUPCAUSE})
exten => h,n,set(CallEndDate1=${STRFTIME(${EPOCH},,%Y%m%d%H%M%S)})
exten => h,n,set(Duration=${CDR(duration)})
exten => h,n,Set(C_End=${STRFTIME(${EPOCH},,%H%M%S)})
exten => h,n,GotoIf($[ "${ContentTime}" = "" ]?SetContenttime0:fwd)
exten => h,n(SetContenttime0),set(ContentTime=0)

exten => h,n(fwd),GotoIf($[ "${userdnis}" = "isdn:30485713" ]?tiscon:maxobd)
exten => h,n(maxobd),GotoIf($[ "${userdnis}" = "isdn:30485715" ]?maxobdexit:obd)
exten => h,n(obd),GotoIf($[ "${userdnis}" = "isdn:30485716" ]?discnct:mcdowell)
exten => h,n(tiscon),NoOp(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.TATA_RECEIVE_OBD&INTOKEN=8&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=1&INPARAM[2]=${Duration}&INPARAM[3]=MCW_LIVEAPP&INPARAM[4]=${CallStartDate1}&INPARAM[5]=NA&INPARAM[6]=${CHANNEL}&INPARAM[7]=${realdnis})
exten => h,n,Set(response=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.TATA_RECEIVE_OBD&INTOKEN=8&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=1&INPARAM[2]=${Duration}&INPARAM[3]=MCW_LIVEAPP&INPARAM[4]=${CallStartDate1}&INPARAM[5]=NA&INPARAM[6]=${CHANNEL}&INPARAM[7]=${realdnis})})
exten => h,n,NoOp(response=${response})
exten => h,n,NoOp(song_listen=${song_listen})
exten => h,n,Goto(ExitLogStatusChk)

exten => h,n(mcdowell),GotoIf( $[ ${isMCWPromo} = 1]?mcwpromoexit:mcwliveappexit)

exten => h,n(mcwpromoexit),NoOp(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_RECEIVE_OBD_PROMOTION&INTOKEN=11&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=1&INPARAM[2]=${Duration}&INPARAM[3]=MCW_PROMO&INPARAM[4]=${CallStartDate1}&INPARAM[5]=NA&INPARAM[6]=0&INPARAM[7]=0&INPARAM[8]=${CHANNEL}&INPARAM[9]=${isAgeVerify}&INPARAM[10]=${realdnis})
exten => h,n,Set(response=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_RECEIVE_OBD_PROMOTION&INTOKEN=11&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=1&INPARAM[2]=${Duration}&INPARAM[3]=MCW_PROMO&INPARAM[4]=${CallStartDate1}&INPARAM[5]=NA&INPARAM[6]=0&INPARAM[7]=0&INPARAM[8]=${CHANNEL}&INPARAM[9]=${isAgeVerify}&INPARAM[10]=${realdnis})})

;exten => h,n(promoskipageverify),Set(response1=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_AGE_VERIFIATION_PROMO&INTOKEN=2&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=${isAgeVerify})})

;update current calls in MCW promotion to remove msisdn IN_ACTION is 0
;exten => h,n,Set(response1=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_UPDATE_CURRENTCALL_PROMOTION&INTOKEN=2&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=0)})
exten => h,n,NoOp(response=${response})
exten => h,n,Set(Service_Name=MCW_PROMO)
exten => h,n,Goto(ExitLogStatusChk)


exten => h,n(mcwliveappexit),NoOp(mcwliveappexit)

exten => h,n,GotoIf($[ "${CallFrom}" = "MCWSONGDEDICATE" ]?mcwsongdedicatehangup:mcwliveappexitcall)
exten => h,n(mcwsongdedicatehangup),NoOp(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_RECEIVE_OBD_LIVE_SONGDEDICATE&INTOKEN=14&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=1&INPARAM[2]=${Duration}&INPARAM[3]=MCW_LIVEAPP&INPARAM[4]=${CallStartDate1}&INPARAM[5]=NA&INPARAM[6]=0&INPARAM[7]=0&INPARAM[8]=${CHANNEL}&INPARAM[9]=${realdnis}&INPARAM[10]=${ISRECHARGE}&INPARAM[11]=${ID}&INPARAM[12]=${lastheardid}&INPARAM[13]=${content})
exten => h,n,Set(response=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_RECEIVE_OBD_LIVE_SONGDEDICATE&INTOKEN=14&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=1&INPARAM[2]=${Duration}&INPARAM[3]=MCW_LIVEAPP&INPARAM[4]=${CallStartDate1}&INPARAM[5]=NA&INPARAM[6]=0&INPARAM[7]=0&INPARAM[8]=${CHANNEL}&INPARAM[9]=${realdnis}&INPARAM[10]=${ISRECHARGE}&INPARAM[11]=${ID}&INPARAM[12]=${lastheardid}&INPARAM[13]=${content})})
exten => h,n,NoOp(response=${response})
exten => h,n,Set(Service_Name=MCW_SONGDEDICATE)	
exten => h,n,Goto(ExitLogStatusChk)

exten => h,n(mcwliveappexitcall),NoOp(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_RECEIVE_OBD_LIVE&INTOKEN=13&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=1&INPARAM[2]=${Duration}&INPARAM[3]=MCW_LIVEAPP&INPARAM[4]=${CallStartDate1}&INPARAM[5]=NA&INPARAM[6]=0&INPARAM[7]=0&INPARAM[8]=${CHANNEL}&INPARAM[9]=${realdnis}&INPARAM[10]=${ID}&INPARAM[11]=${lastheardid}&INPARAM[12]=${content})
exten => h,n,Set(response=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_RECEIVE_OBD_LIVE&INTOKEN=13&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=1&INPARAM[2]=${Duration}&INPARAM[3]=MCW_LIVEAPP&INPARAM[4]=${CallStartDate1}&INPARAM[5]=NA&INPARAM[6]=0&INPARAM[7]=0&INPARAM[8]=${CHANNEL}&INPARAM[9]=${realdnis}&INPARAM[10]=${ID}&INPARAM[11]=${lastheardid}&INPARAM[12]=${content})})
exten => h,n,NoOp(response=${response})	
exten => h,n,Goto(ExitLogStatusChk)

exten => h,n(maxobdexit),NoOp(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Maxlife_IGenius.MAXLIFE_RECEIVE_OBD&INTOKEN=10&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=1&INPARAM[2]=${Duration}&INPARAM[3]=MCW_PROMO&INPARAM[4]=${CallStartDate1}&INPARAM[5]=NA&INPARAM[6]=0&INPARAM[7]=0&INPARAM[8]=${CHANNEL}&INPARAM[9]=0)
exten => h,n,Set(response=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Maxlife_IGenius.MAXLIFE_RECEIVE_OBD&INTOKEN=10&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=1&INPARAM[2]=${Duration}&INPARAM[3]=MCW_PROMO&INPARAM[4]=${CallStartDate1}&INPARAM[5]=NA&INPARAM[6]=0&INPARAM[7]=0&INPARAM[8]=${CHANNEL}&INPARAM[9]=0)})
;update current calls in max obd promotion to remove msisdn IN_ACTION is 0
exten => h,n,Set(response1=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Maxlife_IGenius.MAXLIFE_UPDATE_CURRENTCALL&INTOKEN=2&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=0)})
exten => h,n,NoOp(response=${response})
exten => h,n,Goto(ExitLogStatusChk)



exten => h,n(ExitLogStatusChk),GotoIf($[ "${song_listen}" = "START" ]?SetParam:ExitLog)

;Content Logging
exten => h,n(SetParam),Set(song_listen=END)
exten => h,n,Set(section_end=${STRFTIME(${EPOCH},,%Y%m%d)}${STRFTIME(${EPOCH},,%H%M%S)})
exten => h,n,Set(C_End=${STRFTIME(${EPOCH},,%H%M%S)})
exten => h,n,Set(compare_time=$[${section_end} -${section_begin}])
exten => h,n,NoOp(compare_time is ${compare_time})
exten => h,n,NoOp(BeforeContentTime is ${ContentTime})
exten => h,n,Set(ContentTime=$[${ContentTime}+${compare_time}])
exten => h,n,NoOp(ContentTime is ${ContentTime})
exten => h,n,Set(contentlog=${contentlog}${songId}split${Service_Name}${conf}split${Service_Name}${conf}split${compare_time}split)
exten => h,n,NoOp(contentlog is ${contentlog})
;ContentLogging complete

exten => h,n(ExitLog),Set(contentlog=${contentlog}split)
exten => h,n,NoOp(content=${content})
exten => h,n,NoOp(exit log url is: http://192.168.100.226:8081/hungama/Hungama_ExitLogAsterisk?starttime=${C_Start}&endtime=${C_End}&ani=${usermobno}&dnis=${realdnisdid}&realdnis=${realdnisdid}split${Section_Name}split${modesub}split${callcharge}&contenttime=${ContentTime}&circle=${circle}&operator=${operator}&service=${Service_Name}&subflag=${usr_status}&contentlog=${contentlog}&Usagelog=${Usagelog})
exten => h,n,Set(response=${CURL(http://192.168.100.226:8081/hungama/Hungama_ExitLogAsterisk?starttime=${C_Start}&endtime=${C_End}&ani=${usermobno}&dnis=${realdnisdid}&realdnis=${realdnisdid}split${Section_Name}split${modesub}split${callcharge}&contenttime=${ContentTime}&circle=${circle}&operator=${operator}&service=${Service_Name}&subflag=${usr_status}&contentlog=${contentlog}&Usagelog=${Usagelog})})



;Now directly updating yari anthom song from receive obd procedure

;exten => h,n,GotoIf($[ $[ "${content}" = "803_HUN-SONG-000008"]  | $[ "${content}" = "803_HUN-SONG-000018" ]  | $[ "${content}" = "804_HUN-SONG-000028" ] ]?ContentVerify:discnct)

;exten => h,n(ContentVerify),Set(RechargeAPI=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_CONTENT_VERIFIATION&INTOKEN=2&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=${content})})
;exten => h,n,NoOp(RechargeAPI:http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_CONTENT_VERIFIATION&INTOKEN=2&OUTTOKEN=0&INPARAM[0]=${usermobno}&INPARAM[1]=${content})

exten => h,n,Goto(discnct)

exten => h,n(discnct),hangup




[FetchRead]

exten => 1,1,NoOp(1 pressed)
exten => 2,1,NoOp(2 pressed)
exten => #,1,NoOp(# pressed)

[macro-Test]

exten => s,1(selection),Background(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/msw_age)

exten => s,n,WaitExten()

exten => 1,1,NoOp(1 pressed)
exten => 1,n,Goto(s,selection)

exten => i,1,Goto(s,selection)
exten => t,1,Goto(s,selection)


[macro-PlayContent]

exten => s,1,NoOp(PlayContent flow)
exten => s,n,Set(CNT=0)
exten => s,n,Set(usermobno=${ARG1})
exten => s,n,Set(userdnis=${ARG2})
exten => s,n,Set(IP=${ARG3})
exten => s,n,Set(servlet_path=${ARG4})
exten => s,n,Set(dbServlet=${ARG5})
exten => s,n,Set(getsongslist=${ARG6})
exten => s,n,Set(contentpath=${ARG7})
exten => s,n,Set(lastheard=${ARG8})

exten => s,n,Set(songlength=${CUT(getsongslist,#,-1)})
exten => s,n,NoOp(songlength is ${songlength})
exten => s,n,NoOp(value of lastheard is ${lastheard})

exten => s,n,Set(i=$[${{lastheard}+3])

exten => s,n,While($[${i} < $[${songlength}+2]])

exten => s,n,Set(songId=${CUT(getsongslist,#,${i})})
exten => s,n,NoOp(songId is ${songId})

exten => s,n,Set(contenttype1=${CUT(songId,-,-1)})
exten => s,n,Set(contenttype=${CUT(songId,-,1)})
exten => s,n,Set(contenttype2=${CUT(songId,-,2)})

exten => s,n,NoOp(contenttype2 is ${contenttype2})

exten => s,n,GotoIf( $[ "${contenttype2}" = "ques" ]?waitdtmf:dontwaitdtmf)

exten => s,n(dontwaitdtmf),Read(songkey,${contentpath}/${songId},1,,,3)
exten => s,n,GotoIf($[ "${songkey}" = "1" ]?wronginput)
exten => s,n,GotoIf($[ "${songkey}" = "2" ]?wronginput)
exten => s,n,GotoIf($[ "${songkey}" = "3" ]?wronginput)
exten => s,n,GotoIf($[ "${songkey}" = "4" ]?wronginput)
exten => s,n,GotoIf($[ "${songkey}" = "5" ]?wronginput)
exten => s,n,GotoIf($[ "${songkey}" = "6" ]?wronginput)
exten => s,n,GotoIf($[ "${songkey}" = "7" ]?wronginput)
exten => s,n,GotoIf($[ "${songkey}" = "8" ]?wronginput)
exten => s,n,GotoIf($[ "${songkey}" = "9" ]?wronginput)
exten => s,n,GotoIf($[ "${songkey}" = "*" ]?RingTone)
exten => s,n,GotoIf($[ "${songkey}" = "" ]?noinput)
exten => s,n,Goto(nextsong)
exten => s,n(wronginput),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/wrong)
exten => s,n,Goto(dontwaitdtmf)

exten => s,n(waitdtmf),Read(songkey,${contentpath}/${songId},1,,,20)
exten => s,n,GotoIf($[ "${songkey}" = "1" ]?nextsong)
exten => s,n,GotoIf($[ "${songkey}" = "2" ]?repeatsong)
exten => s,n,GotoIf($[ "${songkey}" = "3" ]?previoussong)
exten => s,n,GotoIf($[ "${songkey}" = "*" ]?RingTone)
exten => s,n,GotoIf($[ "${songkey}" = "" ]?noinput)

exten => s,n(nextsong),Set(i=$[${i}+1])

exten => s,n,Goto(countercheck)

exten => s,n(repeatsong),Set(i=${i})
exten => s,n,Goto(countercheck)
exten => s,n(previoussong),Set(i=$[${i}-1])
exten => s,n,Goto(prevcountercheck)
exten => s,n(noinput),Set(i=$[${i}+1])
exten => s,n,Goto(countercheck)
exten => s,n,NoOp(songId become ${songId})
exten => s,n(prevcountercheck),GotoIf( $[ ${i} < 2 ]?setcounter:countinueloop)

exten => s,n(countercheck),NoOp(counter check calling)

;exten => s,n,NoOp(Calling  update answer url is http://${IP}/${servlet_path}/${dbservlet}?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_STORE_ANSWER&INTOKEN=3&OUTTOKEN=1&INPARAM0=${usermobno}&INPARAM1=${songkey}&INPARAM2=1)
;exten => s,n,Set(Calling  update answer url=${CURL(http://${IP}/${servlet_path}/${dbservlet}?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_STORE_ANSWER&INTOKEN=3&OUTTOKEN=1&INPARAM0=${usermobno}&INPARAM1=${songkey}&INPARAM2=1)})

exten => s,n,NoOp(songlength is: ${songlength})
exten => s,n,NoOp(i value is: ${i})
exten => s,n,GotoIf($[ ${i} > $[${songlength}+1] ] ]?setcounter:countinueloop)
exten => s,n(setcounter),Set(i=2)
exten => s,n(countinueloop),NoOp(Going to next song)
exten => s,n,Goto(endloop)

exten => s,n(RingTone),NoOp(RingTone flow)
exten => s,n,GotoIf($[ "${contenttype}" = "song" ]?CallRingTone:countercheck)
exten => s,n(CallRingTone),NoOp(Going to next song)

exten => s,n(endloop),EndWhile()


[macro-PlayContentNew]

exten => s,1,NoOp(PlayContent flow)
exten => s,n,Set(CNT=0)
exten => s,n,Set(usermobno=${ARG1})
exten => s,n,Set(userdnis=${ARG2})
exten => s,n,Set(IP=${ARG3})
exten => s,n,Set(servlet_path=${ARG4})
exten => s,n,Set(dbServlet=${ARG5})
exten => s,n,Set(getsongslist=${ARG6})
exten => s,n,Set(contentpath=${ARG7})
exten => s,n,Set(lastheard=${ARG8})
exten => s,n,Set(lang=${ARG9})
exten => s,n,Set(X=0)

;Content Logging
exten => s,n,Set(conf=mcdowells)
exten => s,n,Set(ContentTime=0)
exten => s,n,Set(CATEGORY=MCW_MENU)
exten => s,n,Set(song_listen=START)
exten => s,n,Set(Section_Name=PlayContent)
exten => s,n,Set(contentlog=${usermobno}split${userdnis}split${StartDate}split${C_Start}split)
;Content Logging End



exten => s,n,Set(songlength=${CUT(getsongslist,#,-1)})
exten => s,n,NoOp(songlength is ${songlength})
exten => s,n,NoOp(value of lastheard is ${lastheard})

exten => s,n,GotoIf($[ "${lastheard}" = "" ]?SetLastHeard:NoNeedToset)
exten => s,n(SetLastHeard),Set(lastheard=0)

exten => s,n(NoNeedToset),Set(i=$[${lastheard}+2])

exten => s,n,GotoIf($[${i} >= ${songlength}+2]?SetLastHeard)

exten => s,n,While($[${i} < $[${songlength}+2]])

exten => s,n,Set(section_begin=${STRFTIME(${EPOCH},,%Y%m%d)}${STRFTIME(${EPOCH},,%H%M%S)})
exten => s,n,Set(songId=${CUT(getsongslist,#,${i})})
exten => s,n,NoOp(songId is ${songId})

exten => s,n,Set(contenttype1=${CUT(songId,-,-1)})
exten => s,n,Set(contenttype=${CUT(songId,-,1)})
exten => s,n,Set(contenttype2=${CUT(songId,-,2)})
exten => s,n,Set(contenttype3=${CUT(songId,_,3)})

exten => s,n,NoOp(contenttype2 is ${contenttype2})
exten => s,n,NoOp(contenttype3is ${contenttype3})

exten => s,n,GotoIf($[ $[ "${contenttype2}" = "Ad1"]  | $[ "${contenttype2}" = "Ad" ] ]?UpdateAdd:UpdateProfile)

;Update Add count in table
exten => s,n(UpdateAdd),Set(UpdateADD=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCDOWELL_ADD&INTOKEN=1&OUTTOKEN=0&INPARAM[0]=${songId})})
exten => s,n,NoOp(UpdateADD:http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCDOWELL_ADD&INTOKEN=1&OUTTOKEN=0&INPARAM[0]=${songId})

exten => s,n(UpdateProfile),Set(quesretry=0)

;Updating last heard

exten => s,n,Set(lastheardid=$[${i}-2])
exten => s,n,NoOp(lastheardid=${lastheardid})
;exten => s,n,Set(lastheardset=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_LASTHEARD&INTOKEN=3&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=2&INPARAM[2]=$[${i}-2])})

exten => s,n,GotoIf( $[ "${contenttype2}" = "ques" ]?quesretrycheck:checksong)
exten => s,n(checksong),GotoIf( $[ "${contenttype2}" = "SONG" ]?playsong:playclip)

exten => s,n(playclip),Playback(${contentpath}/${songId},skip)

;exten => s,n(playclip),Read(songkey,${contentpath}/${songId},1,,,1)
;exten => s,n,GotoIf($[ "${songkey}" = "1" ]?nextitem)
exten => s,n,Goto(nextitem)



exten => s,n(quesretrycheck),GotoIf( $[ ${quesretry} > 1]?nextitem:askques)

exten => s,n(askques),Read(songkey,${contentpath}/${songId},1,,,3)
exten => s,n,Set(fooQues=${TIMEOUT(digit)})
exten => s,n,NoOp(TIMEOUT value is ${fooQues})

exten => s,n,GotoIf($[ "${songkey}" = "1" ]?nextitem)
exten => s,n,GotoIf($[ "${songkey}" = "2" ]?nextitem)
exten => s,n,GotoIf($[ "${songkey}" = "3" ]?wronginput)
exten => s,n,GotoIf($[ "${songkey}" = "4" ]?wronginput)
exten => s,n,GotoIf($[ "${songkey}" = "5" ]?wronginput)
exten => s,n,GotoIf($[ "${songkey}" = "6" ]?wronginput)
exten => s,n,GotoIf($[ "${songkey}" = "7" ]?wronginput)
exten => s,n,GotoIf($[ "${songkey}" = "8" ]?wronginput)
exten => s,n,GotoIf($[ "${songkey}" = "9" ]?wronginput)
exten => s,n,GotoIf($[ "${songkey}" = "*" ]?wronginput)
exten => s,n,GotoIf($[ "${songkey}" = "#" ]?wronginput)
exten => s,n,GotoIf($[ "${songkey}" = "" ]?noinput)

exten => s,n(wronginput),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/wrong)
exten => s,n,Set(quesretry=$[${quesretry}+1])
exten => s,n,Goto(quesretrycheck)

exten => s,n(noinput),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/noinput)
exten => s,n,Set(quesretry=$[${quesretry}+1])
exten => s,n,Goto(quesretrycheck)

exten => s,n(playsong),NoOp(playsong section)
exten => s,n,NoOp(playing content is ${contentpath}/${songId} for mob no:${usermobno})


exten => s,n,GotoIf($[ $[ "${content}" = "803_HUN-SONG-000008"]  | $[ "${content}" = "803_HUN-SONG-000018" ]  | $[ "${content}" = "804_HUN-SONG-000028" ] ]?Updatecontent:SongSectionPlay)
exten => s,n(Updatecontent),Set(content=802_HUN-SONG-000004)
;Set yari anthom song-User listen yari anthom

exten => s,n(SongSectionPlay),Read(songkey,${contentpath}/${songId},1,,,1)

exten => s,n,GotoIf($[ "${songkey}" = "*" ]?processstar)
exten => s,n,GotoIf($[ "${songkey}" = "" ]?nextitem)
exten => s,n,GotoIf($[ "${songkey}" = "1" ]?wronginputsong)
exten => s,n,GotoIf($[ "${songkey}" = "2" ]?wronginputsong)
exten => s,n,GotoIf($[ "${songkey}" = "3" ]?wronginputsong)
exten => s,n,GotoIf($[ "${songkey}" = "4" ]?wronginputsong)
exten => s,n,GotoIf($[ "${songkey}" = "5" ]?wronginputsong)
exten => s,n,GotoIf($[ "${songkey}" = "6" ]?wronginputsong)
exten => s,n,GotoIf($[ "${songkey}" = "7" ]?wronginputsong)
exten => s,n,GotoIf($[ "${songkey}" = "8" ]?wronginputsong)
exten => s,n,GotoIf($[ "${songkey}" = "9" ]?wronginputsong)
exten => s,n,GotoIf($[ "${songkey}" = "#" ]?wronginputsong)



exten => s,n(wronginputsong),NoOp(Key is -----  ${songkey})
;exten => s,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/wrong)
exten => s,n,Goto(playsong)

exten => s,n(processstar),Set(lastheardset=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_RNGMENU&INTOKEN=5&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=${songId}&INPARAM[2]=DEL&INPARAM[3]=rel&INPARAM[4]=PROCESS)})
exten => s,n,NoOp(Ringtone menu:http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_RNGMENU&INTOKEN=5&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=${songId}&INPARAM[2]=DEL&INPARAM[3]=rel&INPARAM[4]=PROCESS)
exten => s,n,Goto(playsong)

exten => s,n(nextitem),Set(i=$[${i}+1])


;Content Logging
exten => s,n(UpdateContentLog),Set(song_listen=END)
exten => s,n,Set(section_end=${STRFTIME(${EPOCH},,%Y%m%d)}${STRFTIME(${EPOCH},,%H%M%S)})
exten => s,n,Set(compare_time=$[${section_end} -${section_begin}])
exten => s,n,NoOp(compare_time is ${compare_time})
exten => s,n,NoOp(BeforeContentTime is ${ContentTime})
exten => s,n,Set(ContentTime=$[${ContentTime}+${compare_time}])
exten => s,n,NoOp(ContentTime is ${ContentTime})
exten => s,n,Set(contentlog=${contentlog}${songId}splitmcdowells${conf}splitmcdowells${conf}split${compare_time}split)
exten => s,n,NoOp(contentlog is ${contentlog})
;ContentLogging complete

exten => s,n(endloop),EndWhile()
;Intialize last heard with 0
exten => s,n,Set(lastheardset=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCW_LASTHEARD&INTOKEN=3&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=2&INPARAM[2]=0)})

exten => s,n(TncPrompt),Read(songkey,/var/lib/apache-tomcat-6.0.29/webapps/hungama/MCW_LIVEAPP/${lang}/tnc,1,,,5)
exten => s,n,GotoIf($[ "${songkey}" = "*" ]?tncSMS:CallLastheard)
exten => s,n(tncSMS),Set(tnc=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCWTERMS&INTOKEN=1&OUTTOKEN=1&INPARAM[0]=${usermobno})})
exten => s,n,NoOp(tnc menu:http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_ENT_MCDOWELL.MCWTERMS&INTOKEN=1&OUTTOKEN=1&INPARAM[0]=${usermobno})
exten => s,n(CallLastheard),Goto(SetLastHeard)


[macro-ReadContent]

exten => s,1,NoOp(ReadContent flow)
exten => s,n,Set(CNT=0)
exten => s,n,Set(usermobno=${ARG1})
exten => s,n,Set(userdnis=${ARG2})
exten => s,n,Set(IP=${ARG3})
exten => s,n,Set(servlet_path=${ARG4})
exten => s,n,Set(dbServlet=${ARG5})
exten => s,n,Set(getsongslist=${ARG6})
exten => s,n,Set(contentpath=${ARG7})
exten => s,n,Set(lastheard=${ARG8})
exten => s,n,Set(circle=${ARG9})
exten => s,n,Set(lang=${ARG10})


;Content Logging
exten => s,n,Set(conf=Tiscon)
exten => s,n,Set(ContentTime=0)
exten => s,n,Set(CATEGORY=TISCON_MENU)
exten => s,n,Set(song_listen=START)
exten => s,n,Set(Section_Name=PlayContent)
exten => s,n,Set(contentlog=${usermobno}split${userdnis}split${StartDate}split${C_Start}split)
;Content Logging End

exten => s,n,Set(songlength=${CUT(getsongslist,#,-1)})
exten => s,n,NoOp(songlength is ${songlength})
exten => s,n,NoOp(value of lastheard is ${lastheard})

exten => s,n,GotoIf($[ "${lastheard}" = "" ]?SetLastHeard:NoNeedToset)
exten => s,n(SetLastHeard),Set(lastheard=0)

exten => s,n(NoNeedToset),Set(i=$[${lastheard}+2])

exten => s,n,While($[${i} < $[${songlength}+2]])

exten => s,n,Set(songId=${CUT(getsongslist,#,${i})})
exten => s,n,NoOp(songId is ${songId})

exten => s,n,Set(contenttype1=${CUT(songId,_,-1)})
exten => s,n,Set(contenttype=${CUT(songId,_,1)})
exten => s,n,Set(contenttype2=${CUT(songId,_,2)})
exten => s,n,Set(contenttype3=${CUT(songId,_,3)})

exten => s,n,NoOp(contenttype3 is ${contenttype3})

;exten => s,n,GotoIf($[ $[ "${FOO}" = "1" ] & $[ "${BAR}" = "2" ] ]?labelTrue:labelFalse)
exten => s,n,GotoIf($[ $[ "${contenttype3}" = "Ad1"]  | $[ "${contenttype3}" = "Ad" ] ]?UpdateAdd:UpdateProfile)

exten => s,n(UpdateAdd),Set(UpdateADD=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.TISCON_ADD&INTOKEN=1&OUTTOKEN=0&INPARAM[0]=${songId})})
exten => s,n,NoOp(UpdateADD for mobile no:${usermobno}:http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.TISCON_ADD&INTOKEN=1&OUTTOKEN=0&INPARAM[0]=${songId})

exten => s,n,Set(UpdateADD=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.TISCON_USERPROFILE&INTOKEN=4&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=${songId}&INPARAM[2]=ADDSET&INPARAM[3]=$[${i}-2])})
exten => s,n,NoOp(UpdateADD for mobile no:${usermobno}:http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.TISCON_USERPROFILE&INTOKEN=4&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=${songId}&INPARAM[2]=ADDSET&INPARAM[3]=$[${i}-2])})
exten => s,n,Goto(PlayContent)

exten => s,n(UpdateProfile),Set(UpdateADD=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.TISCON_USERPROFILE&INTOKEN=4&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=${songId}&INPARAM[2]=SET&INPARAM[3]=$[${i}-2])})
exten => s,n,NoOp(UpdateADD:http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.TISCON_USERPROFILE&INTOKEN=4&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=${songId}&INPARAM[2]=SET&INPARAM[3]=$[${i}-2])

exten => s,n(PlayContent),NoOp(playsong section for mobile no:${usermobno}:${contentpath}/${songId})
exten => s,n,Set(section_begin=${STRFTIME(${EPOCH},,%Y%m%d)}${STRFTIME(${EPOCH},,%H%M%S)})

exten => s,n,Read(songkey,${contentpath}/${songId},1,,,1)
exten => s,n,GotoIf($[ "${songkey}" = "" ]?nextitem)
exten => s,n,GotoIf($[ "${songkey}" = "9" ]?Account)
exten => s,n(nextitem),Set(i=$[${i}+1])

;Content Logging
exten => s,n,Set(song_listen=END)
exten => s,n,Set(section_end=${STRFTIME(${EPOCH},,%Y%m%d)}${STRFTIME(${EPOCH},,%H%M%S)})
exten => s,n,Set(compare_time=$[${section_end} -${section_begin}])
exten => s,n,NoOp(compare_time is ${compare_time})
exten => s,n,NoOp(BeforeContentTime is ${ContentTime})
exten => s,n,Set(ContentTime=$[${ContentTime}+${compare_time}])
exten => s,n,NoOp(ContentTime is ${ContentTime})
exten => s,n,Set(contentlog=${contentlog}${songId}splitTiscon${conf}splitTiscon${conf}split${compare_time}split)
exten => s,n,NoOp(contentlog is ${contentlog})
;ContentLogging complete
exten => s,n(endloop),EndWhile()

exten => s,n,NoOp(songlength is ${songlength})
exten => s,n,GotoIf($[ ${i} >= $[${songlength}+2] ] ]?init:endloop)

;exten => s,n(init),Set(i=2)

exten => s,n(init),Set(lastheardset=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.TISCON_USERPROFILE&INTOKEN=4&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=&INPARAM[2]=DELETE&INPARAM[3]=$[${i}-2])})
exten => s,n,NoOp(lastheardset:http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.TISCON_USERPROFILE&INTOKEN=4&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=&INPARAM[2]=DELETE&INPARAM[3]=$[${i}-2])
exten => s,n,hangup()

exten => s,n,Goto(SetLastHeard)

exten => s,n(Account),NoOp(Account manager flow)

exten => s,n(CallPlayContent),Macro(Account,${usermobno},${userdnis},localhost:8080,hungama,hul_dbinteraction,${getsongslist},/var/lib/apache-tomcat-6.0.29/webapps/hungama/content/Tiscon,${qno},${circle},${lang})

exten => s,n(ChkLang),Read(menu,/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/${lang}/press9_lang_change,1,,,1)
exten => s,n,GotoIf($[ "${menu}" = "1" ]?sethin)
exten => s,n,GotoIf($[ "${menu}" = "2" ]?setben)
exten => s,n,GotoIf($[ "${menu}" = "3" ]?settam)
exten => s,n,Goto(chkInputstatus)

exten => s,n(ageretrycheck),GotoIf( $[ ${ageretry} > 1]?sethin:ChkLang)

exten => s,n(noinput),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/${lang}/no_input)
exten => s,n,Set(ageretry=$[${ageretry}+1])
exten => s,n,Goto(ageretrycheck)

exten => s,n(chkInputstatus),GotoIf($[ "${menu}" = "" ]?noinput:wrongInput)
exten => s,n(wrongInput),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/${lang}/wrong_input)
exten => s,n,Set(ageretry=$[${ageretry}+1])
exten => s,n,Goto(ageretrycheck)

exten => s,n(sethin),Set(lang=hin)
exten => s,n,Goto(LangUpdate)

exten => s,n(setben),Set(lang=ben)
exten => s,n,Goto(LangUpdate)

exten => s,n(settam),Set(lang=tam)
exten => s,n,Goto(LangUpdate)

exten => s,n(LangUpdate),Set(response=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.LangUpdate&INTOKEN=2&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=${lang})})
exten => s,n,NoOp(calling url http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.LangUpdate&INTOKEN=2&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=${lang})

exten => s,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/${lang}/Repeat_Lang)
exten => s,n,Goto(FetchConfig)

;Fetching content from config file
exten => s,n(FetchConfig),NoOp(calling url http://192.168.100.226:8081/hungama/ar_ReadConfigSongAsterisk?ConfigPath=Hungama_Tiscon/${lang}/Tiscon.cfg&TOKEN=FREE)
exten => s,n,Set(getsongslist=${CURL(http://192.168.100.226:8081/hungama/ar_ReadConfigSongAsterisk?ConfigPath=Hungama_Tiscon/${lang}/Tiscon.cfg&TOKEN=FREE)})
exten => s,n(CallPlayContent),Macro(ReadContent,${usermobno},${userdnis},localhost:8080,hungama,hul_dbinteraction,${getsongslist},/var/lib/apache-tomcat-6.0.29/webapps/hungama/content/Tiscon,${qno})


[macro-PlayIdeaContent]

exten => s,1,NoOp(PlayIdeaContent flow)
exten => s,n,Set(usermobno=${ARG1})
exten => s,n,Set(userdnis=${ARG2})
exten => s,n,Set(getsongslist=${ARG3})
exten => s,n,Set(contentpath=/var/lib/apache-tomcat-6.0.29/webapps/hungama/content/IdeaAd)

exten => s,n,Set(songlength=${CUT(getsongslist,#,-1)})
exten => s,n,NoOp(songlength is ${songlength})

exten => s,n,Set(i=0)
exten => s,n(StartCounter),While($[${i} < $[${songlength}+2]])

exten => s,n,Set(songId=${CUT(getsongslist,#,${i})})
exten => s,n,NoOp(songId is ${songId})

exten => s,n,Set(contenttype1=${CUT(songId,-,-1)})
exten => s,n,Set(contenttype=${CUT(songId,-,1)})
exten => s,n,Set(contenttype2=${CUT(songId,-,2)})
exten => s,n,Set(contenttype3=${CUT(songId,_,3)})


exten => s,n,NoOp(contenttype3 is ${contenttype3})

exten => s,n,NoOp(playsong section for mobile no:${usermobno}:${contentpath}/${songId})

exten => s,n,GotoIf($[ $[ "${contenttype2}" = "Ad1"]  | $[ "${contenttype2}" = "Ad" ] ]?PlayContent:ReadContent)
exten => s,n(PlayContent),Playback(${contentpath}/${songId})
exten => s,n,Goto(nextitem)

exten => s,n(ReadContent),Read(songkey,${contentpath}/${songId},1,,,3)
exten => s,n,GotoIf($[ "${songkey}" = "1" ]?nextitem)
exten => s,n,GotoIf($[ "${songkey}" = "2" ]?ReadContent)
exten => s,n,GotoIf($[ "${songkey}" = "3" ]?previoussong)
exten => s,n,GotoIf($[ "${songkey}" = "6" ]?keypadinfo)
exten => s,n,GotoIf($[ "${songkey}" = "8" ]?MainMenu)
exten => s,n(nextitem),Set(i=$[${i}+1])
exten => s,n,Goto(endloop)

exten => s,n(previoussong),Set(i=$[${i}-1])
exten => s,n(endloop),EndWhile()
exten => s,n,Set(i=0)
exten => s,n,Goto(StartCounter)
exten => s,n,hangup()
exten => s,n(MainMenu),Goto(mcw1,66785800,playsection)

exten => s,n(keypadinfo),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/IdeaAD/Keypad)
exten => s,n,Goto(StartCounter)

[macro-Account]

exten => s,1,NoOp(ReadContent flow)
exten => s,n,Set(CNT=0)
exten => s,n,Set(usermobno=${ARG1})
exten => s,n,Set(userdnis=${ARG2})
exten => s,n,Set(IP=${ARG3})
exten => s,n,Set(servlet_path=${ARG4})
exten => s,n,Set(dbServlet=${ARG5})
exten => s,n,Set(getsongslist=${ARG6})
exten => s,n,Set(contentpath=${ARG7})
exten => s,n,Set(lastheard=${ARG8})
exten => s,n,Set(circle=${ARG9})
exten => s,n,Set(lang=${ARG10})

exten => s,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/${lang}/press9_lang_change)

exten => s,n(ChkLang),GotoIf($[ "${circle}" = "tnu" ]?chkLangAPD:chkBen)
;exten => s,n(chkBen),GotoIf($[ "${circle}" = "kol" ]?chkLangBen:chkRestIndia)

exten => s,n(chkBen),GotoIf($[ $[ "${circle}" = "kol" ] | $[ "${circle}" = "wbl" ] ]?chkLangBen:chkRestIndia)


exten => s,n(chkLangAPD),Read(menu,/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/tam/lang_selection,1,,,5)
exten => s,n,GotoIf($[ "${menu}" = "1" ]?settam)
exten => s,n,GotoIf($[ "${menu}" = "2" ]?sethin)
exten => s,n,Goto(chkInputstatus)


exten => s,n(chkLangBen),Read(menu,/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/ben/lang_selection,1,,,5)
exten => s,n,GotoIf($[ "${menu}" = "1" ]?setben)
exten => s,n,GotoIf($[ "${menu}" = "2" ]?sethin)
exten => s,n,Goto(chkInputstatus)

exten => s,n(chkRestIndia),Read(menu,/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/hin/lang_selection,1,,,5)
exten => s,n,GotoIf($[ "${menu}" = "1" ]?sethin)
exten => s,n,GotoIf($[ "${menu}" = "2" ]?setben)
exten => s,n,GotoIf($[ "${menu}" = "3" ]?settam)
exten => s,n,Goto(chkInputstatus)

exten => s,n(ageretrycheck),GotoIf( $[ ${ageretry} > 1]?AssignLang:ChkLang)

exten => s,n(AssignLang),GotoIf($[ "${circle}" = "tnu" ]?settam:setben)

exten => s,n(noinput),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/${lang}/no_input)
exten => s,n,Set(ageretry=$[${ageretry}+1])
exten => s,n,Goto(ageretrycheck)

exten => s,n(chkInputstatus),GotoIf($[ "${menu}" = "" ]?noinput:wrongInput)
exten => s,n(wrongInput),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/${lang}/wrong_input)
exten => s,n,Set(ageretry=$[${ageretry}+1])
exten => s,n,Goto(ageretrycheck)

exten => s,n(sethin),Set(lang=hin)
exten => s,n,Goto(LangUpdate)

exten => s,n(setben),Set(lang=ben)
exten => s,n,Goto(LangUpdate)

exten => s,n(settam),Set(lang=tam)
exten => s,n,Goto(LangUpdate)

exten => s,n(LangUpdate),Set(response=${CURL(http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.LangUpdate&INTOKEN=2&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=${lang})})
exten => s,n,NoOp(calling url http://192.168.100.226:8081/hungama/hul_dbinteraction?PROCEDURE=Hungama_Tatasky.LangUpdate&INTOKEN=2&OUTTOKEN=1&INPARAM[0]=${usermobno}&INPARAM[1]=${lang})
exten => s,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/${lang}/lang_saved)
exten => s,n,Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/${lang}/Welcome_Lang)
exten => s,n,Goto(FetchConfig)

exten => s,n(RepeatUser),Playback(/var/lib/apache-tomcat-6.0.29/webapps/hungama/Tiscon/${lang}/Repeat_Lang)

;Fetching content from config file
exten => s,n(FetchConfig),NoOp(calling url http://192.168.100.226:8081/hungama/ar_ReadConfigSongAsterisk?ConfigPath=Hungama_Tiscon/${lang}/Tiscon.cfg&TOKEN=FREE)
exten => s,n,Set(getsongslist=${CURL(http://192.168.100.226:8081/hungama/ar_ReadConfigSongAsterisk?ConfigPath=Hungama_Tiscon/${lang}/Tiscon.cfg&TOKEN=FREE)})

exten => s,n(CallPlayContent),Macro(ReadContent,${usermobno},${userdnis},localhost:8080,hungama,hul_dbinteraction,${getsongslist},/var/lib/apache-tomcat-6.0.29/webapps/hungama/content/Tiscon,${qno},${circle},${lang})


